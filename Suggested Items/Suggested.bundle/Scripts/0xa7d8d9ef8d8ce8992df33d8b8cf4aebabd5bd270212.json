{
  "kind" : "js",
  "screensaverFileName" : "Dive",
  "value" : "const V=\"20211108b\",C={};C.layoutProbs={1:20,2:1,3:1,4:1},C.layouts={1:{areas:[[0,0,1,1]],cellCount:{1:.5,2:3,3:4,4:3,5:2,6:1,7:2,8:1,9:2,10:1,11:1,12:1,15:.2}},2:{areas:[[-.25,0,.5,1],[.25,0,.5,1]],cellCount:{1:1,2:1,3:1,4:1,5:1},patternProbs:{mono:1},syncProb:1,setCount:{1:1}},3:{areas:[[-.25,-.25,.5,.5],[.25,-.25,.5,.5],[0,.25,1,.5]],cellCount:{1:1,2:1,3:1,4:1,5:1},patternProbs:{mono:1},syncProb:1,setCount:{1:1}},4:{areas:[[-.25,-.25,.5,.5],[.25,-.25,.5,.5],[-.25,.25,.5,.5],[.25,.25,.5,.5]],cellCount:{1:1,2:1,3:1,4:1,5:1},patternProbs:{mono:1},syncProb:1,setCount:{1:1}}},C.colorMode={normal:.7,phased:.1,bw:.05,bw1c:.15},C.syncProbs={normal:.05,phased:0,bw:.67,bw1c:.67,normal_random:.5},C.directions={inward:1,outward:20,random:1,random_per_group:1,opposite_per_group:5},C.exclusiveColorsProb=.4,C.colorCount={2:3,3:3,4:8,5:1,6:1,7:1,8:1},C.colors={\"#00ff00\":.1,\"#ffff00\":1,\"#00ffff\":1,\"#0000ff\":.1,\"#7100bf\":1,\"#ff00ff\":1,\"#ff0000\":1,\"#ed1e79\":1,\"#000000\":.1,\"#ffffff\":1},C.patternProbs={random:.5,mono:2,checkered1x1:.5,checkered2x2:1,checkered1x2:1,checkered1x1x3:1,checkered2x3:1,checkered50perc:1,lines:1,lines3:1,waffle:1,outline:1,concentricSquares:3,concentricSquares3:1,split:2},C.patternParams={random:{directions:{inward:1,outward:50,random:1},setCount:{1:1,2:1,3:1,4:1,5:1,6:1},exclusiveColorsProb:0},mono:{tile:\"0\",directions:{inward:1,outward:50,random:1}},checkered1x1:{tile:\"01|10\"},checkered2x2:{tile:\"0011|0011|1100|1100\"},checkered1x2:{tile:\"01|01|10|10\",rotate:!0},checkered1x1x3:{tile:\"012|120|201\",mirror:!0},checkered2x3:{tile:\"01|23|45\",rotate:!0},lines:{tile:\"01\",rotate:!0},lines3:{tile:\"012\",rotate:!0},waffle:{tile:\"10|00\",n:2,m:1},checkered50perc:{n:2,m:0},outline:{},concentricSquares:{n:2,m:1},concentricSquares3:{n:4,m:1},split:{n:2,m:0,rotate:!0}},C.ease=a=>M.pow(a,1.1),C.speed=[.0025,.0035],C.size=[.6,.9];class Grid{constructor(a,b,c,d,e,f,g=!1){const h=72,i=[[1,0],[0,1],[-1,0],[0,-1]],j=function(a){const b=Array.from(new Set(a.flat())).sort((c,a)=>c-a);return a.forEach(a=>{a.forEach((c,d)=>{a[d]=b.indexOf(c)})}),a},k=function(a,b,c){const d=a[c%a.length],e=d[b%d.length];return e},l=a=>{const b=OV(a),c=b.reduce((a,b)=>1==b?a:a+1,0),d=b.reduce((a,b)=>-1==b?a:a+1,0);return c==d?0:c<d?-1:1},m=(a,b,c)=>{const d=OK(a).length,e=this.rnd.pckwm(a,MM(c*b,d)),f=[];for(let d=0;d<b;d++)f.push([]);for(let d=0;d<MX(e.length,2*b);d++){const a=f[d%b];a.push(e[d%e.length])}return f},n=a=>\"inward\"===a?-1:\"outward\"===a?1:this.rnd.b()?-1:1,o=b=>{const c=a.singleGrid,f=MM(d,e)\/b,g=MR(MX(d,e)\/f);let h,i;return d>e?(i=b,h=c&&1==i?1:g):(h=b,i=c&&1==h?1:g),{gw:h,gh:i}},p=(a,b)=>{if(b.mirror&&(this.rnd.b()&&a.reverse(),this.rnd.b()&&a.forEach(a=>a.reverse())),b.rotate&&this.rnd.b()){const b=[];for(let c=0;c<a[0].length;c++){b[c]=[];for(let d=0;d<a.length;d++)b[c][d]=a[d][c]}a=b}return a},q=[];this.rnd=new Rnd(f);const r=a;let s,t=+this.rnd.pckw(r.cellCount),u=+(1==t?2:this.rnd.pckw(r.colorCount)),v=r.colors,w=r.patternId||(1==t?\"mono\":this.rnd.pckw(r.patternProbs)),x=r.patternParams[w];null!=x.n&&null!=x.m&&(t=function(a,b,c,d=0){const e=MX(d,MR((a-c)\/b));return b*e+c}(t,x.n,x.m,1));let{gw:z,gh:A}=o(t);const y=-1!=[\"outline\",\"concentricSquares\",\"concentricSquares3\"].indexOf(w);let B=((a,b,c,e,d)=>{d||(c=e=h);let f=[];for(let g=0;g<e;g++){const a=[];f.push(a);for(let b=0;b<c;b++)a.push(0)}const g=function(a,b,d){0<=b&&b<e&&0<=a&&a<c&&(f[b][a]=d)},k=function(a){const b=MC(c\/2)-1,d=MC(e\/2)-1,f=MF(MX(c,e))+1;for(let c=0;c<f;c++){for(let e=b-c;e<=b+c;e++)g(e,d-c,c%a),g(e,d+c,c%a);for(let e=d-c;e<=d+c;e++)g(b-c,e,c%a),g(b+c,e,c%a)}},l=function(a,b){const d=b?1:MC(MM(c,e))\/2;for(let f=0;f<d;f++){const b=(f+1)%a,d=f,h=c-1-f,i=f,j=e-1-f;for(let a=i;a<=j;a++)g(d,a,b),g(h,a,b);for(let a=d;a<=h;a++)g(a,i,b),g(a,j,b)}};let m;switch(b.tile&&(m=p(b.tile.split(\"|\").map(a=>a.split(\"\").map(a=>+a)),b)),a){case\"concentricSquares3\":{1==(c%2==e%2)?k(3):l(3);break}case\"concentricSquares\":{1==(c%2==e%2)?k(2):l(2);break}case\"outline\":{l(2,!0);break}case\"split\":{const a=this.rnd.b(),b=a?MF(e\/2):0,d=a?0:MF(c\/2);for(let a=b;a<e;a++)for(let b=d;b<c;b++)g(b,a,1);break}case\"checkered50perc\":{const a=MF(MM(c,e)\/2);for(let b=0;b<e;b++)for(let d=0;d<c;d++)MF(d\/a)%2!=MF(b\/a)%2&&g(d,b,1);break}case\"random\":{const a=this.rnd.pckw(b.setCount);let f=MM(c\/2),h=MM(e\/2),j=0,k=1;for(let b=0;b<M.pow(MX(c,e),2);b++){const b=i[j%4];for(let c=1;c<=k;c++)f+=b[0],h+=b[1],g(f,h,MF(this.rnd.f()*a));1==j%2&&k++,j++}break}default:{const a=m.length,b=m[0].length;for(let d=0;d<e;d++)for(let e=0;e<c;e++)g(e,d,m[d%a][e%b])}}return j(f)})(w,x,z,A,y),C=new Set(B.flat()).size;const D=r.mode||this.rnd.pckw(r.colorMode);let E=null==r.sync?null==r.syncProbs[D+\"_\"+w]?this.rnd.p(r.syncProbs[D]):this.rnd.p(r.syncProbs[D+\"_\"+w]):r.sync;const F=\"phased\"==D,G=[];if(F){for(let a=0;a<C;a++)G[a]=a\/C;s=[this.rnd.pckwm(v,u)]}else{const a=null==x.exclusiveColorsProb?r.exclusiveColorsProb:x.exclusiveColorsProb;if(C<OK(v).length&&this.rnd.p(a))s=m(v,C,u);else{s=[];for(let a=0;a<C;a++){const a=this.rnd.pckwm(v,u);s.push(a)}}switch(D){case\"bw\":{s=s.map(()=>[\"#000000\",\"#ffffff\"]),u=2;break}case\"bw1c\":{v=OA({},v),delete v[\"#000000\"],delete v[\"#ffffff\"];const a=this.rnd.pckw(v);s=s.map(()=>[\"#000000\",\"#ffffff\",a]),u=3;break}}}if(!g){const a=this.rnd=new Rnd(f),g=[];for(let b=0;b<h;b++){g.push([]);for(let c=0;c<h;c++)g[b].push(a.hsh())}const i=OA({},x.directions||r.directions);(E||F)&&delete i.random;const j=a.pckw(i),o=2,m=(d+o)\/z,p=(e+o)\/A,t=[],u=[],v=[],w=MF((h-z)\/2),C=MF((h-A)\/2),D=MF((B[0].length-z)\/2),H=MF((B.length-A)\/2);for(let d=0;d<A;d++)for(let e=0;e<z;e++){const f=k(B,D+e,H+d),i=F?0:f,o=s[i],x=b+-z\/2*m+e*m,y=c+-A\/2*p+d*p;E||F?(null==t[i]&&(t[i]=a.hsh()),v[i]=(r.speed[0]+r.speed[1])\/2):(t[i]=g[(C+d+360)%h][(w+e+360)%h],null==v[i]&&(v[i]=a.rng(r.speed)));let I;switch(j){case\"random_per_group\":{null==u[i]&&(u[i]=a.b()?-1:1),I=u[i];break}case\"opposite_per_group\":{null==u[i]&&(u[i]=l(u)||(a.b()?-1:1)),I=u[i];break}default:{I=n(j);break}}const J=new Cell([x,y,m,p],o,I,v[i],r,t[i]);q.push(J),J.upd(F?G[f]\/v[i]:0)}}this.upd=a=>{q.forEach(b=>b.upd(a)),this.drw()},this.drw=()=>{q.forEach(a=>a.drw())},this.features={cellCount:z*A,setCount:C,colorSets:s,sync:E,mode:D,pattern:w}}}class Cell{constructor(a,b,c,d,e,f){const g=new Rnd(f),j=[],k=(a,c)=>{const d=c?j[j.length-1]:j[0];Cell.exceptColors[0]=d?d.color:null;const f=g.pck(b,Cell.exceptColors),h=g.rng(e.size);a-=c?0:h;const i={pos:a,size:h,color:f};return c?j.push(i):j.unshift(i),i};for(let h=0;1>=h;){const a=k(h,!0);if(1==j.length){const b=g.f()*a.size;a.pos-=b,h-=b}h+=a.size}this.upd=a=>{for(j.forEach(b=>b.pos+=a*d*c);0>j[0].pos+j[0].size;)j.shift();for(;0<j[0].pos;)k(j[0].pos,!1);for(;2<=j.length&&1<j[j.length-2].pos;)j.pop();for(;1<=j.length&&1>j[j.length-1].pos;)k(j[j.length-1].pos+j[j.length-1].size,!0)},this.drw=()=>{const[b,d,f,g]=a,h=MX(f,g)\/2,i=b+f\/2,k=d+g\/2,l=ctx.createRadialGradient(i,k,0,i,k,h),m=-j[0].pos\/j[0].size;let n=Clr.lerpHex(j[0].color,j[1].color,m);l.addColorStop(0,n);for(let a,b=1;b<j.length;b++)if(a=j[b],1<a.pos){n=Clr.lerpHex(j[b-1].color,a.color,1-(a.pos-1)\/j[b-1].size),l.addColorStop(1,n);break}else l.addColorStop(e.ease(a.pos),a.color);ctx.fillStyle=ctx.strokeStyle=l,ctx.lineWidth=2,ctx.strokeRect(b,d,f,g),ctx.fillRect(b,d,f,g)}}}Cell.exceptColors=[];const Clr={};Clr.lerpHex=function(a,b,c){const d=Clr.lerp(parseInt(a.substr(-6),16),parseInt(b.substr(-6),16),c);return\"#\"+(\"000000\"+d.toString(16)).substr(-6)},Clr.lerp=function(a,c,d){const e=MR(((c>>16)-(a>>16))*d+(a>>16)),f=MR(((255&c>>8)-(255&a>>8))*d+(255&a>>8)),g=MR(((255&c)-(255&a))*d+(255&a));return(e<<16)+(f<<8)+g};const Rnd=function(a){let b,c,d=Uint32Array.from([0,1,c=b=2,3].map(b=>parseInt(a.substr(8*b+2,8),16)));this.f=()=>(b=d[3],d[3]=d[2],d[2]=d[1],d[1]=c=d[0],b^=b<<11,d[0]^=b^b>>>8^c>>>19,d[0]\/M.pow(2,32)),this.b=()=>.5>this.f(),this.pck=(a,b)=>{if(null!=b){var c=[];for(let e in a){var d=a[e];-1==b.indexOf(d)&&c.push(d)}a=c}return a[MF(this.f()*a.length)]},this.btw=(a,b,c,d)=>{var e=this.f();if(d){var g=M.pow(.5>e?2*e:2*(1-e),d);e=.5>e?g\/2:1-g\/2}var f=a+e*(b-a);return c?MF(f):f},this.rng=(a,b,c)=>this.btw(a[0],a[1],b,c),this.pckw=a=>OK(a)[this.pckwi(OV(a))],this.pckwm=(a,b,c=!1)=>{const d=OV(a),e=OK(a),f=[];for(let g=0;g<b;g++){const a=this.pckwi(d),b=e[a];f.push(c?+b:b),d.splice(a,1),e.splice(a,1)}return f},this.pckwi=a=>{const b=a.reduce(function(a,b){return a+b},0);let c=this.f()*b;return a.findIndex(a=>(c-=a,0>c))},this.hsh=()=>[...Array(64)].reduce(a=>a+MF(16*this.f()).toString(16),\"0x\"),this.p=a=>this.f()<a},M=Math,MF=M.floor,MC=M.ceil,MR=M.round,MM=M.min,MX=M.max,O=Object,OV=O.values,OK=O.keys,OA=O.assign;let w,h,gs,tl,sync,mode,tc=0;const rst=a=>{const b=new Rnd(tokenData.hash),c=C,d=b.pckw(c.layoutProbs),e=c.layouts[d],f=e.areas;mode=b.pckw(c.colorMode),sync=e.syncProb&&b.p(e.syncProb);const g=f.map(()=>b.hsh());gs=f.map(([b,d,i,j],k)=>{const l=OA({},c);return l.cellCount=e.cellCount,e.patternProbs&&(l.patternProbs=e.patternProbs),l.sync=sync,l.mode=mode,l.singleGrid=1==f.length,new Grid(l,b*w+w\/2,d*h+h\/2,w*i,h*j,g[k],a)}),1==gs.length&&(sync=gs[0].features.sync),gs.forEach(a=>a.drw())},rsz=()=>{const a=innerWidth,b=innerHeight,c=devicePixelRatio;0<a&&(ctx.scale(c,c),w=cvs.width=MF(a*c),h=cvs.height=MF(b*c),cvs.style.width=a+\"px\",cvs.style.height=b+\"px\",rst())},tck=()=>{if(!gs)return;const a=Date.now(),b=a-tl;tl=a,tc++;let c=30<tc?MM(10,60*(b\/1e3)):1;gs.forEach(a=>{a.upd(c)})};let cvs,ctx,W=window,D=document;W.onload=function(){cvs=D.querySelector(\"canvas\"),ctx=cvs.getContext(\"2d\");let a=D.querySelector(\"meta[name=viewport]\");try{a||(a=D.createElement(\"meta\"),a.name=\"viewport\",D.getElementsByTagName(\"head\")[0].appendChild(a)),a.setAttribute(\"content\",\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\")}catch(a){console.log(\"Failed to set meta[name=viewport] tag: \"+a)}let b;W.onresize=W.onorientationchange=()=>{null!=b&&clearTimeout(b),b=setTimeout(rsz,20)},setTimeout(()=>{rsz(),setInterval(tck,1e3\/60)},34)};"
}