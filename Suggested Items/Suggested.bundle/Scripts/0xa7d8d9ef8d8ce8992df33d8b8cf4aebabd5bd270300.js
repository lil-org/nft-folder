(()=>{var L=Math.pow;var to=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var Mt=to(()=>{THREE.OrbitControls=function(o,e){var s,n,i,c,a;this.object=o,this.domElement=e!==void 0?e:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(h),t.update(),p=x.NONE},this.update=(s=new THREE.Vector3,n=new THREE.Quaternion().setFromUnitVectors(o.up,new THREE.Vector3(0,1,0)),i=n.clone().invert(),c=new THREE.Vector3,a=new THREE.Quaternion,function(){var d=t.object.position;return s.copy(d).sub(t.target),s.applyQuaternion(n),r.setFromVector3(s),t.autoRotate&&p===x.NONE&&ot(2*Math.PI/60/60*t.autoRotateSpeed),r.theta+=E.theta,r.phi+=E.phi,r.theta=Math.max(t.minAzimuthAngle,Math.min(t.maxAzimuthAngle,r.theta)),r.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,r.phi)),r.makeSafe(),r.radius*=S,r.radius=Math.max(t.minDistance,Math.min(t.maxDistance,r.radius)),t.target.add(te),s.setFromSpherical(r),s.applyQuaternion(i),d.copy(t.target).add(s),t.object.lookAt(t.target),t.enableDamping===!0?(E.theta*=1-t.dampingFactor,E.phi*=1-t.dampingFactor,te.multiplyScalar(1-t.dampingFactor)):(E.set(0,0,0),te.set(0,0,0)),S=1,!!(N||c.distanceToSquared(t.object.position)>m||8*(1-a.dot(t.object.quaternion))>m)&&(t.dispatchEvent(h),c.copy(t.object.position),a.copy(t.object.quaternion),N=!1,!0)}),this.dispose=function(){t.domElement.removeEventListener("contextmenu",Ct,!1),t.domElement.removeEventListener("mousedown",Rt,!1),t.domElement.removeEventListener("wheel",wt,!1),t.domElement.removeEventListener("touchstart",At,!1),t.domElement.removeEventListener("touchend",It,!1),t.domElement.removeEventListener("touchmove",Ot,!1),document.removeEventListener("mousemove",it,!1),document.removeEventListener("mouseup",nt,!1),window.removeEventListener("keydown",St,!1)};var t=this,h={type:"change"},f={type:"start"},u={type:"end"},x={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},p=x.NONE,m=1e-6,r=new THREE.Spherical,E=new THREE.Spherical,S=1,te=new THREE.Vector3,N=!1,Re=new THREE.Vector2,we=new THREE.Vector2,Se=new THREE.Vector2,Et=new THREE.Vector2,$e=new THREE.Vector2,et=new THREE.Vector2,Ue=new THREE.Vector2,tt=new THREE.Vector2,vt=new THREE.Vector2;function yt(){return Math.pow(.95,t.zoomSpeed)}function ot(d){E.theta-=d}function gt(d){E.phi-=d}var je,zt=(je=new THREE.Vector3,function(d,b){je.setFromMatrixColumn(b,0),je.multiplyScalar(-d),te.add(je)}),Tt=function(){var d=new THREE.Vector3;return function(b,H){t.screenSpacePanning===!0?d.setFromMatrixColumn(H,1):(d.setFromMatrixColumn(H,0),d.crossVectors(t.object.up,d)),d.multiplyScalar(b),te.add(d)}}(),Jt=function(){var d=new THREE.Vector3;return function(b,H){var ae=t.domElement===document?t.domElement.body:t.domElement;if(t.object.isPerspectiveCamera){var Me=t.object.position;d.copy(Me).sub(t.target);var He=d.length();He*=Math.tan(t.object.fov/2*Math.PI/180),zt(2*b*He/ae.clientHeight,t.object.matrix),Tt(2*H*He/ae.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(zt(b*(t.object.right-t.object.left)/t.object.zoom/ae.clientWidth,t.object.matrix),Tt(H*(t.object.top-t.object.bottom)/t.object.zoom/ae.clientHeight,t.object.matrix)):t.enablePan=!1}}();function _t(d){t.object.isPerspectiveCamera?S/=d:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*d)),t.object.updateProjectionMatrix(),N=!0):t.enableZoom=!1}function $t(d){t.object.isPerspectiveCamera?S*=d:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/d)),t.object.updateProjectionMatrix(),N=!0):t.enableZoom=!1}function Rt(d){if(t.enabled!==!1){switch(d.preventDefault(),t.domElement.focus?t.domElement.focus():window.focus(),d.button){case t.mouseButtons.LEFT:if(d.ctrlKey||d.metaKey||d.shiftKey){if(t.enablePan===!1)return;V(d),p=x.PAN}else{if(t.enableRotate===!1)return;(function(b){Re.set(b.clientX,b.clientY)})(d),p=x.ROTATE}break;case t.mouseButtons.MIDDLE:if(t.enableZoom===!1)return;(function(b){Ue.set(b.clientX,b.clientY)})(d),p=x.DOLLY;break;case t.mouseButtons.RIGHT:if(t.enablePan===!1)return;V(d),p=x.PAN}p!==x.NONE&&(document.addEventListener("mousemove",it,!1),document.addEventListener("mouseup",nt,!1),t.dispatchEvent(f))}}function it(d){if(t.enabled!==!1)switch(d.preventDefault(),p){case x.ROTATE:if(t.enableRotate===!1)return;(function(b){we.set(b.clientX,b.clientY),Se.subVectors(we,Re).multiplyScalar(t.rotateSpeed);var H=t.domElement===document?t.domElement.body:t.domElement;ot(2*Math.PI*Se.x/H.clientHeight),gt(2*Math.PI*Se.y/H.clientHeight),Re.copy(we),t.update()})(d);break}}function nt(d){t.enabled!==!1&&(document.removeEventListener("mousemove",it,!1),document.removeEventListener("mouseup",nt,!1),t.dispatchEvent(u),p=x.NONE)}function wt(d){t.enabled===!1||t.enableZoom===!1||p!==x.NONE&&p!==x.ROTATE||(d.preventDefault(),d.stopPropagation(),t.dispatchEvent(f),function(b){b.deltaY<0?$t(yt()):b.deltaY>0&&_t(yt()),t.update()}(d),t.dispatchEvent(u))}function St(d){}function At(d){if(t.enabled!==!1){switch(d.preventDefault(),d.touches.length){case 1:if(t.enableRotate===!1)return;(function(b){Re.set(b.touches[0].pageX,b.touches[0].pageY)})(d),p=x.TOUCH_ROTATE;break;case 2:if(t.enableZoom===!1&&t.enablePan===!1)return;(function(b){if(t.enableZoom){var H=b.touches[0].pageX-b.touches[1].pageX,ae=b.touches[0].pageY-b.touches[1].pageY,Me=Math.sqrt(H*H+ae*ae);Ue.set(0,Me)}})(d),p=x.TOUCH_DOLLY_PAN;break;default:p=x.NONE}p!==x.NONE&&t.dispatchEvent(f)}}function Ot(d){if(t.enabled!==!1)switch(d.preventDefault(),d.stopPropagation(),d.touches.length){case 1:if(t.enableRotate===!1||p!==x.TOUCH_ROTATE)return;(function(b){we.set(b.touches[0].pageX,b.touches[0].pageY),Se.subVectors(we,Re).multiplyScalar(t.rotateSpeed);var H=t.domElement===document?t.domElement.body:t.domElement;ot(2*Math.PI*Se.x/H.clientHeight),gt(2*Math.PI*Se.y/H.clientHeight),Re.copy(we),t.update()})(d);break;case 2:if(t.enableZoom===!1&&t.enablePan===!1||p!==x.TOUCH_DOLLY_PAN)return;(function(b){if(t.enableZoom){var H=b.touches[0].pageX-b.touches[1].pageX,ae=b.touches[0].pageY-b.touches[1].pageY,Me=Math.sqrt(H*H+ae*ae);tt.set(0,Me),vt.set(0,Math.pow(tt.y/Ue.y,t.zoomSpeed)),_t(vt.y),Ue.copy(tt)}if(t.enablePan){var He=.5*(b.touches[0].pageX+b.touches[1].pageX),eo=.5*(b.touches[0].pageY+b.touches[1].pageY);$e.set(He,eo),et.subVectors($e,Et).multiplyScalar(t.panSpeed),Jt(et.x,et.y),Et.copy($e)}t.update()})(d);break;default:p=x.NONE}}function It(d){t.enabled!==!1&&(t.dispatchEvent(u),p=x.NONE)}function Ct(d){t.enabled!==!1&&d.preventDefault()}t.domElement.addEventListener("contextmenu",Ct,!1),t.domElement.addEventListener("mousedown",Rt,!1),t.domElement.addEventListener("wheel",wt,!1),t.domElement.addEventListener("touchstart",At,!1),t.domElement.addEventListener("touchend",It,!1),t.domElement.addEventListener("touchmove",Ot,!1),window.addEventListener("keydown",St,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return this.target}},noZoom:{get:function(){return!this.enableZoom},set:function(o){this.enableZoom=!o}},noRotate:{get:function(){return!this.enableRotate},set:function(o){this.enableRotate=!o}},noPan:{get:function(){return!this.enablePan},set:function(o){this.enablePan=!o}},noKeys:{get:function(){return!this.enableKeys},set:function(o){this.enableKeys=!o}},staticMoving:{get:function(){return!this.enableDamping},set:function(o){this.enableDamping=!o}},dynamicDampingFactor:{get:function(){return this.dampingFactor},set:function(o){this.dampingFactor=o}}})});Mt();var Ne,oo,Le=/HeadlessChrome/.test(window.navigator.userAgent),q=window,st=window.innerWidth,at=window.innerHeight,io=parseInt(tokenData.hash.slice(0,16),16);function Ee(o,e,s,n){o.xp=e,o.yp=s,o.zp=n}function ze(o,e,s,n){o.sizeX=e,o.sizeY=s,o.sizeZ=n}function no(o,e,s,n){return function(){o>>>=0,e>>>=0,s>>>=0,n>>>=0;var i=o+e|0;return o=e^e>>>9,e=s+(s<<3)|0,s=s<<21|s>>>11,n=n+1|0,i=i+n|0,s=s+i|0,(i>>>0)/4294967296}}var $=no(2654435769,608135816,3084996962,io),fe=0,re=1,de=2,Pe=3,ce=4,oe=5,Ae=0,Ht=1,rt=2,so=11;var ke="music",Nt="memory",Lt="language",Pt="art",Be="friends",Dt="conflict",Yt="game",ct="heritage",Fe="energy",Zt="peace",Xt="home",Ut="faith",ao=[Nt,Lt,Pt,Be,Dt,Yt,ct,Fe,Zt,Xt,Ut,ke],ro=[4804692,9409944,14015196,13226452,11056313,9411489,8161163,6055016,2698288,1513243,12566463,8092561],co=[15905715,13464448,11023181,9635116,11472193,13309526,13902692,13317741,12667254,13401501,14531790,15662079],lo=[15060945,9674936,4288671,673407,2370380,4067353,6959150,11111305,15263460,15386305,12989735,14188148],ho=[15894313,15299870,14705427,13783564,11944978,10106392,8667188,7627111,6587289,8952744,12431786,15910572],fo=[82789,3763336,7378091,9613251,7643577,5608111,6197413,9279900,12427922,14071460,15126462,16246744],po=[2914950,7640688,12366682,15976008,16170051,16364350,16162866,15566111,14969101,13335083,11311449,9288071],xo=[14242386,11154741,8132632,6754575,10439491,14059127,13277589,7964316,2651044,3180734,5679838,8178942],uo=[3685235,6253464,8821693,10465223,9269631,8139576,9053220,12075843,15098723,15894131,15903101,15912328],mo=[227494,2986425,5745355,8106441,9207947,10309452,10301479,9052444,7868945,9388094,11829887,14271679],bo=[1519173,1463142,1472904,2725277,7837323,12949369,15042404,14116939,13191218,13659727,14592639,15460270],Eo=[3326664,7129999,10999126,13490227,11912784,10401134,10197888,11368584,12604816,12671641,12348835,12091565],vo=[1914204,1204354,560040,43970,108983,173996,2530967,7179896,11763289,10910809,8224612,5538415],yo=[15100512,15037032,14973297,14517376,12950179,11317446,11516625,13481924,15447222,12290183,7425613,2561299],go=[15916928,14599052,13346711,11441060,7903411,4300226,2132920,1335446,538228,3363719,7440811,11452367],zo=[12566463,14016492,11255770,8626889,6655931,4684973,4554415,6198210,7907796,6062760,3033191,68902],To=[15889010,11233413,6512280,2775976,1797809,819642,2196661,6059938,9923471,12289955,14069699,15915236],_o=[15902645,15304092,14705539,13190508,9056090,4921673,4070743,6371973,8738739,10581453,12227807,13874162],Ro=[3421236,4473924,5592405,9211020,13684944,16119285,16514043,15000804,7960953,15907606,16771363,855309],wo=[10990515,8887714,6785169,7771807,11848142,15924477,13096406,10268335,7375245,4286063,16733440,1196881],So=[2239020,4015174,5791585,7567739,9344149,11054767,12830922,14607332,16383486,16745013,16745013,4607568],Ao=w([So,wo,Ro,ro,co,lo,ho,fo,po,xo,uo,mo,bo,Eo,vo,yo,go,zo,To,_o]),B=[];for(let o of Ao)B.push(new THREE.Color(o));var W=0,Z=1,F=2,lt=3,le=4,K=5,pe=6,jt="pending",Oo="noroom",Io="grew",Co="split",Mo="end of g",De=10,_=$()*De,A=$()*De,O=$()*De,X,Ge,ht,Ve=0,kt=0,v=9,qe=w([Ht,Ae,rt]),Bt=Array.from({length:100},()=>so);Bt[0]=Ae;var ft=w(Bt),xe=w(["allnone","rand","3sides","onlyborder","box","stripes","noborder"]);ft===Ae&&(xe="noborder");var ie=Array.from({length:100},()=>!0),Q=w([40]),P=2,he=1,J=w(["bloom-out","bloom-in","insideout","side2side","top2bottom","outsidein"]),Ho=.05,ne=20,g=[3,3,3],R=[10,10,10],ue=-1,T=[];for(let o=0;o<100;o++)T.push(w([Z,F,W]));var U=Array.from({length:100},()=>[1,1,1]),C=Array.from({length:100},()=>.5),No=w([0,1,2]),Lo=w(ao),I=oo||Lo;v=11;g=[1,1,1];R=[0,0,0];Q=2e3;var ve=2;if(I===Nt){he=.5,ne=3,P=l(4,6),A=1,_=24,O=2;for(let o=0;o<v;o++)o%2===0?T[o]=Z:o%2===1&&(T[o]=W);Q=4,C=Array.from({length:100},()=>Y(.25,.5)),g[1]=parseInt(Y(3,8)),R=[1,15,1]}else if(I===Lt){ne=5,P=4,A=l(1,4),_=50*parseInt(l(1,3)),O=l(10,15),U=Array.from({length:100},()=>[l(.8,1.1),l(.8,1.1),l(.8,1.1)]);for(let o=0;o<v;o++)o<v*.25?T[o]=Z:o<v*.5?T[o]=pe:T[o]=w([Z,F,W]),C[o]=l(.15,.5);Q=10,R=[Y(_*2,_*2+5),0,0]}else if(I===Pt){he=.3,ne=5,ve=4,P=l(2,2.5)/1.5,$()<.5&&(P*=2),A=l(3,5),_=l(3,5),O=l(3,5),v=12;let o=w([le,K,pe]);for(let e=0;e<v;e++)if(e<v*.5){C[e]=.5;let s=l(.5,.9);o===K?U[e]=[1,s,1]:o===le?U[e]=[1,1,s]:U[e]=[s,1,1],T[e]=lt}else U[e]=[.8,.8,.8],C[e]=.5,T[e]=o;Q=200,g[0]=1,R[0]=Y(_,_+.5),ue=1}else if(I===Be){he=.5,ne=3,P=5,A=1,_=l(4,6),O=l(2,3);let o=parseInt(Y(3,5));g=[o,o,o],U=Array.from({length:100},()=>[l(.7,1.2),l(.75,.95),l(.65,1.2)]);for(let e=0;e<v;e++)e<v*.25?T[e]=Z:e<v*.5?T[e]=W:T[e]=w([Z,F,W]);Q=3,R=[20,20,20],ue=20}else if(I===Dt){ne=3,P=l(1.5,4),xe==="onlyborder"&&(P=12),A=l(80,100),_=l(1,1),O=l(1,1),v=15,U=Array.from({length:100},()=>[l(.8,1),l(.8,1),l(.8,1)]);for(let o=0;o<v;o++)o<v*.25?T[o]=le:T[o]=w([Z,F,W]);Q=50}else if(I===ct){he=.5,ne=5,P=l(3.25,4);let o=parseInt(Math.floor(l(1,8)));A=2*o,_=2,O=2,Q=4;for(let n=0;n<v;n++)n<v*.65?T[n]=K:n%2==0?T[n]=Z:T[n]=W;let e=18+o*2,s=parseInt(Y(4,6));g=[s+1,s,1],R=[e,e+o*2,e]}else if(I===Yt){A=l(8,12),_=l(2,4),O=_,v=16,U=Array.from({length:100},()=>[l(.7,1.3),l(.7,1.3),l(.7,1.3)]),Q=80,P=l(1,2);for(let o=0;o<v;o++)o<v*.65?T[o]=K:T[o]=F;g[0]=parseInt(Y(8,16)),R[0]=20}else if(I===Fe){he=.5,ne=6,ve=3.5;let o=l(1,3);P=l(1.25,4),A=o,_=o,O=o,U=Array.from({length:100},()=>[l(.8,1.2),l(.8,1.2),l(.8,1.2)]),Q=50;for(let n=0;n<v;n++)n<v/3?T[n]=le:n<v*2/3?T[n]=K:T[n]=pe;let e=parseInt(Y(1,4));g=[e,e,1];let s=o*12;R=[s,s,s]}else if(I===Zt){he=2,ne=20,P=l(1,2),xe==="onlyborder"&&(P=2),A=.1,_=l(10,30),O=l(10,30),v=parseInt(l(15,20)),U=Array.from({length:100},()=>[l(.8,1.5),l(.8,1.5),l(.8,1.5)]),Q=30;let o=w([K,pe]);for(let e=0;e<v;e++)T[e]=o,C[e]=l(.1,.5)}else if(I===Xt){he=3.25,ne=60,ve=.5,P=l(1.25,3),A=1,_=l(6,16),O=l(6,16),U=Array.from({length:100},()=>[l(.8,1.5),l(.8,1.5),l(.8,1.5)]),Q=30;for(let o=0;o<v;o++)o<v*.5?T[o]=K:T[o]=F;g[2]=parseInt(Y(10,20)),R=[40,40,40]}else if(I===Ut){he=.5,ne=3,P=1.25,ve=4;let o=w([0,1,2]),e=l(1,5),s=l(5,10),n=l(1,5);A=e,O=s,_=n,o<1?(A=e,_=s,O=n):o>1&&(_=e,A=s,O=n),v=20,U=Array.from({length:100},()=>[l(.6,1.2),l(.6,1.2),l(.6,1.2)]);for(let i=0;i<v;i++)w(o===0?[K,le]:o===1?[pe,le]:[pe,K])}else if(I===ke){he=2,P=l(1.5,2),v=11,Q=300;for(let o=0;o<v;o++)o<3?w([F]):o<7?w([lt]):w([K,le]),C[o]=l(.15,.25)}var Ye=Array.from({length:v+1},()=>[]),Po=2e4,D,ye,j,Do,G,Oe,Yo=q.devicePixelRatio<=1;ft===Ae&&(_=De/2,A=_,O=A);var Ft=[[_,A,O]];for(let o=1;o<v;o++){let e=Ft[o-1].concat([]);e[0]*=1,e[1]*=1,e[2]*=1,Ft.push(e)}var dt=De*_*15,pt=.5,We,z=[],Zo=["xp","yp","zp","sizeX","sizeY","sizeZ","rotX","rotY","rotZ"],Ze=[5,5,5,5,5,5,5,5];Ze[re]=3;J==="outsidein"&&(Ze[re]=8);Ze[ce]=10;Le&&(Ze=[0,0,0,0,0,0,0,0]);var y=re,Ke,Qe=_e(),me=!0,xt,be,Gt=.01,Xe=50,Vt=100;Le&&(Xe=4,Vt=1);var Je;ft===Ae?Je=new THREE.SphereBufferGeometry(.5,16,16):Je=new THREE.InstancedBufferGeometry().copy(new THREE.BoxBufferGeometry(1,1,1));var ee=new THREE.Object3D,se,ge=[],Xo,qt=new THREE.MeshPhongMaterial({wireframe:!1,side:THREE.DoubleSide,specular:13421772,dithering:!0,reflectivity:1,flatShading:!1,transparent:!0,shininess:1,opacity:1});qt.onBeforeCompile=function(o){let e="attribute vec3 scale;varying vec2 vUv;attribute vec3 df;attribute vec3 db;varying vec3 vN2;varying vec3 fd;varying vec3 bd;varying vec4 wp;varying vec3 sp;",s="vUv=uv;vN2=normal;fd=df;bd=db;vColor=instanceColor;sp=scale;wp=modelMatrix*instanceMatrix*vec4(position, 1.0);vec4 pos=projectionMatrix*viewMatrix*wp;gl_Position=pos;",n="varying float _id;uniform float border_thickness;uniform float Bcolor_thickness;uniform float line_count_factor;varying vec2 vUv;varying vec4 wp;varying vec3 vN2;varying vec3 sp;varying vec3 fd;varying vec3 bd;bool eq(float a,float o) {return abs(a-o)<0.01;}",i="vec3 col=vColor;float alpha=opacity;vec2 spm=sp.xy;float NONE=-1.;float LINES_V=-2.;float LINES_H=-3.;float INVISIBLE=-4.;float INVISIBLE_BCOLORED=-5.;float NOBORDER=-6.;float type=round(fd.z);if(vN2.x > 0.){spm=sp.zy;type=fd.x;}else if(vN2.y > 0.){spm=sp.xz;type=fd.y;}else if(vN2.z>0.){spm=sp.xy;type=fd.z;}else if(vN2.x<0.){spm=sp.zy;type=bd.x;}else if(vN2.y < 0.){spm=sp.xz;type=bd.y;} else{spm = sp.xy;type=bd.z;} float lt=20.;vec3 st=vec3(1.);if (col.x>0.5 && col.y>0.5 && col.z > 0.5){ st=vec3(0.5);} if (eq(type,LINES_H)) { float num_lines = float(int(spm.y/line_count_factor));float py = abs(fract(num_lines*vUv.y)*2.0-1.0);if(py < lt / 100.0){ col = st;} } else if (eq(type,LINES_V)) { float num_lines =float(int(spm.x/line_count_factor));float px = abs(fract(num_lines*vUv.x)*2.0-1.0);if(px < lt / 100.0){ col=st;} }else if (eq(type,INVISIBLE) || eq(type,INVISIBLE_BCOLORED)) {alpha=0.;} float threshP = border_thickness;vec3 pborder_color = vec3(0.);if (eq(type,INVISIBLE_BCOLORED)) { pborder_color=vColor;threshP = threshP*Bcolor_thickness;} float threshX=threshP/spm.x;float threshY=threshP/spm.y;if (!eq(type,NOBORDER) && (vUv.x < threshX || vUv.x > (1.0-threshX) || vUv.y < threshY || vUv.y > (1.0-threshY))) { col = pborder_color;alpha=1.;diffuseColor=vec4(col, alpha);gl_FragColor=diffuseColor;}if(eq(alpha,0.)){discard;}diffuseColor=vec4(col,alpha);gl_FragColor=diffuseColor;";Xo=o,o.uniforms.line_count_factor={value:he},o.uniforms.Bcolor_thickness={value:ne},o.uniforms.border_thickness={value:Ho},o.vertexShader=e+`
`+o.vertexShader,o.vertexShader=o.vertexShader.replace("#include <begin_vertex>",`#include <begin_vertex>
`+s),o.fragmentShader=n+`
`+o.fragmentShader,o.fragmentShader=o.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );",`vec4 diffuseColor=vec4( diffuse, opacity );
`+i)};function ut(o){return D.aspect>1?at/(o*2):st/(o*2)}function Uo(o){se=new THREE.InstancedMesh(Je,qt,o),se.castShadow=!0,se.receiveShadow=!0,ko(Je),ye.add(se),jo(se)}function l(o,e){return $()*(e-o)+o}function M(o,e){let s=Math.pow(10,e);return Math.round(o*s)/s}function jo(o){if(z.length!=0){for(let e=0;e<z.length;e++){let s=z[e];ee.position.set(s.xp,s.yp,s.zp),s.visible?ee.scale.set(s.sizeX,s.sizeY,s.sizeZ):ee.scale.set(0,0,0),ee.rotation.set(s.rotX,s.rotY,s.rotZ),ee.updateMatrix(),se.setMatrixAt(e,ee.matrix),se.setColorAt(e,s.color)}se.instanceMatrix.needsUpdate=!0}}function ko(o){let e=[],s=[],n=[],i=-1,c=-2,a=-3,t=-4,h=-5,f=-6,u={};for(let x=0;x<z.length;x++){let p=z[x],m=[i,i,i,i,i,i];if(xe==="box"){let r=w([0,1,2]);m=[h,h,h,h,h,h],m[r]=i,m[r+3]=i}else if(xe==="onlyborder")m=[h,h,h,h,h,h];else if(xe==="3sides")m=[i,i,i,t,t,t];else if(xe==="noborder")m=[f,f,f,f,f,f];else if(xe==="stripes")for(let r=0;r<6;r++)m[r]=w([c,a]);else if(xe==="rand"){let r=p.hash();if(u[r])m=u[r];else{for(let E=0;E<6;E++)m[E]=w([c,a,i,t]);u[r]=m}}e.push(m[0],m[1],m[2]),s.push(m[3],m[4],m[5]),n.push(p.sizeX,p.sizeY,p.sizeZ)}o.setAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(n),3)),o.setAttribute("df",new THREE.InstancedBufferAttribute(new Float32Array(e),3)),o.setAttribute("db",new THREE.InstancedBufferAttribute(new Float32Array(s),3)),o.attributes.df.needsUpdate=!0,o.attributes.db.needsUpdate=!0,o.attributes.scale.needsUpdate=!0}function w(o){return o[$()*o.length>>0]}var Wt=0,k=class{constructor(e,s,n,i,c,a,t,h,f,u){Wt++,this.id=Wt,this.g=u,this.dir=f,ze(this,c,a,t),this.children=[],Ee(this,e,s,n),this.rotX=this.rotY=this.rotZ=0,this.vx=this.vy=this.vz=0,this.colorR=h.r,this.colorG=h.g,this.colorB=h.b,this.color=h,this.animation={enabled:!1,state:qe===rt?fe:de,current_stage:0,stage:[{targets:{}},{targets:{}},{targets:{}},{targets:{}},{targets:{}},{targets:{}}]},this.visible=!0,this.segmented=!1,this.already_grown=jt,this.destroyed=!1,this.parent=i}seedbox(){return this.get_parent()}get_parent(){return this.parent?this.parent:this}destroy(){this.destroyed=!0,z=bt(z,this),this.parent&&(this.parent.children=bt(this.parent.children,this)),Ye[this.g].includes(this)&&(Ye[this.g]=bt(Ye[this.g],this))}step(){switch(this.animation.state){case fe:return this.float();case Pe:break;case oe:break;default:let e=this,s=!0,n=e.animation.stage[e.animation.state],i=n.speed,c=n.targets;for(let a in c){let t=c[a]-e[a];e[a]+=t/i,Math.abs(t)>Gt&&(s=!1)}if(e.color=new THREE.Color(e.colorR,e.colorG,e.colorB),s){let a=e.animation.stage[e.animation.state].targets;for(let t in a)e[t]=a[t];if(e.color=new THREE.Color(e.colorR,e.colorG,e.colorB),e.animation.state===re&&J==="outsidein"&&e.changeState(oe),e.animation.state===ce){if(J==="bloom-out")for(let t=0;t<e.children.length;t++)Ee(e.children[t],e.xp,e.yp,e.zp),e.children[t].changeState(ce);e.changeState(oe)}return!0}break}return!1}float(){let e=L(L(this.xp,2)+L(this.yp,2)+L(this.zp,2),.5),s=35;e<30&&(s=0),e>150&&(e=150);let n=-s*this.xp/L(e,3),i=-s*this.yp/L(e,3),c=-s*this.zp/L(e,3),a=2;this.vx+=n,this.vy+=i,this.vz+=c;let t=L(L(this.vx,2)+L(this.vy,2)+L(this.vz,2),.5)/a;t>1&&(this.vx/=t,this.vy/=t,this.vz/=t),this.xp+=this.vx,this.yp+=this.vy,this.zp+=this.vz;let h=Math.max(this.sizeX,this.sizeY,this.sizeZ),f=Math.max(h,10);this.rotX+=this.vx/f,this.rotY+=this.vy/f,this.rotZ+=this.vz/f}changeState(e){this.animation.state!==e&&(e===oe?this.animation.enabled=!1:this.animation.enabled=!0),this.animation.state=e}create_segment_box(e,s,n){let i,c,a=B[this.g%B.length],t=B[(1+this.g)%B.length];return n[Z]===1?(i=new k(this.xp+this.sizeX/4,this.yp,this.zp,this.parent,this.sizeX/2,this.sizeY,this.sizeZ,a,this.dir,e),c=new k(this.xp-this.sizeX/4,this.yp,this.zp,this.parent,this.sizeX/2,this.sizeY,this.sizeZ,t,{x:this.dir.x*-1,y:this.dir.y,z:this.dir.z},e)):n[F]===1?(i=new k(this.xp,this.yp+this.sizeY/4,this.zp,this.parent,this.sizeX,this.sizeY/2,this.sizeZ,a,this.dir,e),c=new k(this.xp,this.yp-this.sizeY/4,this.zp,this.parent,this.sizeX,this.sizeY/2,this.sizeZ,t,{x:this.dir.x*-1,y:this.dir.y,z:this.dir.z},e)):(i=new k(this.xp,this.yp,this.zp+this.sizeZ/4,this.parent,this.sizeX,this.sizeY,this.sizeZ/2,a,this.dir,e),c=new k(this.xp,this.yp,this.zp-this.sizeZ/4,this.parent,this.sizeX,this.sizeY,this.sizeZ/2,t,{x:this.dir.x*-1,y:this.dir.y,z:this.dir.z},e)),i.segmented=!0,c.segmented=!0,[i,c]}hash(){return this.g*1+(this.sizeX+this.sizeY+this.sizeZ)*1e3>>0}create_rotate_box(e,s,n){let i=this.xp,c=this.yp,a=this.zp,t=this.xp,h=this.yp,f=this.zp,u={x:this.dir.x,y:this.dir.y,z:this.dir.z},x,p,m,r,E,S;x=Math.min(Math.max(this.sizeX*U[e][0],pt),dt),p=Math.min(Math.max(this.sizeY*U[e][1],pt),dt),m=Math.min(Math.max(this.sizeZ*U[e][2],pt),dt),r=x,E=p,S=m;let te=B[this.hash()%B.length].clone();if(s===W){u.z*=-1;let N=p;p=x,x=N,N=E,E=r,r=N,a=this.zp+(this.sizeZ/2+m*(1-C[e]))*this.dir.z,f=this.zp-(this.sizeZ/2+S*C[e])*this.dir.z,m=m*(1-C[e])*2,S=S*C[e]*2}else if(s===Z){u.x*=-1;let N=p;p=m,m=N,N=E,E=S,S=N,i=this.xp+(this.sizeX/2+x*(1-C[e]))*this.dir.x,t=this.xp-(this.sizeX/2+r*C[e])*this.dir.x,x=x*(1-C[e])*2,r=r*C[e]*2}else if(s===F){u.y*=-1;let N=x;x=m,m=N,N=r,r=S,S=N,c=this.yp+(this.sizeY/2+p*(1-C[e]))*this.dir.y,h=this.yp-(this.sizeY/2+E*C[e])*this.dir.y,p=p*(1-C[e])*2,E=E*C[e]*2}return n===1?new k(i,c,a,this,x,p,m,te,u,e+1):new k(t,h,f,this,r,E,S,te,this.dir,e+1)}split(){let e=Math.max(this.sizeX,this.sizeY,this.sizeZ);if(this.parent&&e>Q){let s=[parseInt(this.sizeZ/e),parseInt(this.sizeX/e),parseInt(this.sizeY/e)],n=[],i=this.create_segment_box(this.g,1,s);return n.push(i[0]),n.push(i[1]),this.destroy(),Te(i[0],!1),Te(i[1],!1),!0}return!1}grow(e){if(this.already_grown!==jt)return!0;if(e<v){this.already_grown=Io;let s=T[e];if(this.split())return this.already_grown=Co,!1;let n=this.create_rotate_box(e,s%3,1),i=this.create_rotate_box(e,(s+1)%3,1),c=this.create_rotate_box(e,(s+2)%3,1),a=this.create_rotate_box(e,s%3,-1),t=this.create_rotate_box(e,(s+1)%3,-1),h=this.create_rotate_box(e,(s+2)%3,-1),f=[[n,a],[n],[a],[i,t],[i],[t],[c,h],[c],[h]],u=[n,a,i,t,c,h],x,p=[];if(T[e]===le){n=this.create_rotate_box(e,Z,1),i=this.create_rotate_box(e,F,1),c=this.create_rotate_box(e,Z,-1),x=this.create_rotate_box(e,F,-1),u=[n,i,c,x];for(let r=0;r<u.length;r++)ie[e]&&!Ce(u[r],z)?p.push(u[r]):u[r].destroy()}else if(T[e]===K){n=this.create_rotate_box(e,Z,1),i=this.create_rotate_box(e,W,1),c=this.create_rotate_box(e,Z,-1),x=this.create_rotate_box(e,W,-1),u=[n,i,c,x];for(let r=0;r<u.length;r++)ie[e]&&!Ce(u[r],z)?p.push(u[r]):u[r].destroy()}else if(T[e]===pe){n=this.create_rotate_box(e,F,1),i=this.create_rotate_box(e,W,1),c=this.create_rotate_box(e,F,-1),x=this.create_rotate_box(e,W,-1),u=[n,i,c,x];for(let r=0;r<u.length;r++)ie[e]&&!Ce(u[r],z)?p.push(u[r]):u[r].destroy()}else if(T[e]===lt)for(let r=0;r<u.length;r++)ie[e]&&!Ce(u[r],z)?p.push(u[r]):u[r].destroy();else for(let r=0;r<f.length;r++){let E=!0;for(let S=0;S<f[r].length;S++)if(ie[e]&&Ce(f[r][S],z)){E=!1;break}if(E){p.push(f[r]);break}}if(p.length===0){this.already_grown=Oo+" "+f.length+"..."+ie[e];return}let m=[].concat.apply([],p);for(let r=0;r<m.length&&Te(m[r],ie[e]);r++);if(this.parent===null){this.visible=!1;for(let r=0;r<this.children.length;r++){let E=this.children[r];(s===W||s===K||s===pe)&&(E.zp+=E.dir.z*this.sizeZ/2),(s===F||s===pe||s===le)&&(E.yp+=E.dir.y*this.sizeY/2),(s===Z||s===K||s===le)&&(E.xp+=E.dir.x*this.sizeX/2)}}return!0}return this.already_grown=Mo,!0}};Bo();function Y(o,e){return o+$()*(e-o)}function Bo(){We=new THREE.Clock;try{Do=new Stats}catch(p){}let o=q.innerWidth,e=q.innerHeight,s=o/-2,n=o/2,i=e/2,c=e/-2;D=new THREE.OrthographicCamera(s,n,i,c,-1e3,1e5),D.position.set(125*10,200*10,-125*10),window.camera=D,ye=new THREE.Scene;let a=B.pop();ye.background=new THREE.Color(a),Ne=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2,10,10),new THREE.ShaderMaterial({uniforms:{c1:{value:a},c2:{value:B[0]},utype:{value:No},r:{value:q.innerWidth/q.innerHeight},time:{value:.5}},vertexShader:"uniform float time;uniform float utype; varying float type;varying vec2 vUv;varying float vtime;void main(){type=utype;vtime=time;vUv=uv;gl_Position = vec4(position, 1.);}",fragmentShader:`
//noise from https://github.com/ashima/webgl-noise (MIT License)
vec3 mod289(vec3 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 mod289(vec4 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 permute(vec4 x) {return mod289(((x*34.0)+10.0)*x);} vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}
float snoise(vec3 v){const vec2 C = vec2(1.0/6.0, 1.0/3.0);const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);vec3 i  = floor(v + dot(v, C.yyy) );vec3 x0=v - i + dot(i, C.xxx);vec3 g = step(x0.yzx, x0.xyz);vec3 l = 1.0 - g;vec3 i1 = min( g.xyz, l.zxy );vec3 i2 = max( g.xyz, l.zxy );  
vec3 x1 = x0 - i1 + C.xxx;vec3 x2 = x0-i2 + C.yyy; vec3 x3 = x0 - D.yyy;i = mod289(i);
vec4 p = permute( permute( permute( i.z + vec4(0.0, i1.z, i2.z, 1.0 ))+ i.y + vec4(0.0, i1.y, i2.y, 1.0 )) + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));  float n_ = 0.142857142857; // 1.0/7.0
vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p * ns.z * ns.z);vec4 x_ = floor(j * ns.z);vec4 y_ = floor(j - 7.0 * x_ );vec4 x = x_ *ns.x + ns.yyyy;vec4 y = y_ *ns.x + ns.yyyy;vec4 h = 1.0 - abs(x) - abs(y);  vec4 b0 = vec4( x.xy, y.xy );vec4 b1 = vec4( x.zw, y.zw );  vec4 s0 = floor(b0)*2.0 + 1.0;vec4 s1 = floor(b1)*2.0 + 1.0;vec4 sh = -step(h, vec4(0.0));  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;  vec3 p0 = vec3(a0.xy,h.x);vec3 p1 = vec3(a0.zw,h.y);vec3 p2 = vec3(a1.xy,h.z);vec3 p3 = vec3(a1.zw,h.w);  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));p0 *= norm.x;p1 *= norm.y;p2 *= norm.z;p3 *= norm.w;vec4 m=max(0.5-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 105.0 * dot( m*m,vec4( dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}

bool eq(float a,float o) {return abs(a-o)<0.01;}varying float vtime;varying float type;varying vec2 vUv;uniform vec3 c1;uniform vec3 c2;uniform float r;
void main(){vec2 uv = (vUv - 0.5) * vec2(r, 1.);
if (eq(type,0.)) {gl_FragColor =vec4( mix( c1, c2, length(uv)), 1.);} else if (eq(type,1.)) {float n=snoise(vec3(0.5*vUv.x,0.5*vUv.y,vtime/10.));gl_FragColor =vec4(mix(c1,c2,n),1.);} else {gl_FragColor = vec4(c1,1.);}}`})),Ne.material.depthWrite=!1,Ne.renderOrder=-99999,ye.add(Ne),j=new THREE.WebGLRenderer({powerPreference:"high-performance",antialias:Yo,stencil:!1,logarithmicDepthBuffer:!0}),j.setPixelRatio(q.devicePixelRatio),j.setSize(q.innerWidth,q.innerHeight),j.shadowMap.enabled=!0,j.shadowMapSoft=!0,j.outputEncoding=THREE.sRGBEncoding,j.shadowMap.type=THREE.PCFSoftShadowMap,X=new THREE.SpotLight(16777215,1,0,Math.PI/3),Ge=new THREE.Group,Ge.add(X),X.position.set(-330,220,880),X.castShadow=!0,X.shadow.camera.near=100,X.shadow.camera.far=1e5,X.shadow.camera.right=15*5*10,X.shadow.camera.left=-15*5*10,X.shadow.camera.top=15*5*10,X.shadow.camera.bottom=-15*5*10,X.shadow.mapSize.width=1024*8,X.shadow.mapSize.height=1024*8,X.shadow.radius=5,X.shadow.bias=-1e-4,ye.add(Ge);let t=new THREE.HemisphereLight(16777215,16777215,.5);ye.add(t),document.body.appendChild(j.domElement),q.addEventListener("resize",Qt);function h(p){Oe=!0,G.autoRotateSpeed=.75,x()}q.addEventListener("mousedown",h),q.addEventListener("touchstart",h);var f;q.addEventListener("mousemove",function(){f=0});function u(p){Oe=!0,G.autoRotateSpeed=.75}q.addEventListener("keydown",p=>{if(p.key!==" ")return;j.render(ye,D);let m=j.domElement.toDataURL();var r=document.createElement("a");typeof r.download=="string"?(document.body.appendChild(r),r.download="assemblage"+new Date().toISOString()+".jpg",r.href=m,r.click(),document.body.removeChild(r)):window.location.replace(uri)}),j.domElement.addEventListener("mousewheel",u),j.domElement.addEventListener("wheel",u);function x(){var p=_e(),m=p-f;m<600&&m>0&&Ie(),f=_e()}G=new THREE.OrbitControls(D,j.domElement),G.minDistance=100,G.maxDistance=500,G.enablePan=!1,Fo(),Qt(),mt(),ht=ut(320/ve*.95),Le&&(D.zoom=be,D.updateProjectionMatrix())}function Te(o,e){return o.destroyed||z.length>Po?!1:e&&Ce(o,z)?(o.destroy(),!1):(o.parent&&(o.parent.children.includes(o)||o.parent.children.push(o)),z.push(o),Ye[o.g].push(o),!0)}function _e(){return new Date().getTime()}function mt(){Qe=_e(),me=!0,kt=We.getElapsedTime(),Ve=0,Oe=!1,y===de?be=ht:y===fe?be=ut(150):be=ut(xt/P)}function Ie(){if(Oe=!1,Ke=null,y===fe)y=re;else if(y===re||y===Pe||y===ce||y===oe)y=de,me=!0;else if(y===de){for(let o=0;o<z.length;o++){let e=z[o],s=e.xp,n=e.yp,i=Math.atan2(n,s)+Math.PI/2,c=1.02,a=e.animation.stage[ce].targets;ze(e,a.sizeX,a.sizeY,a.sizeZ),e.vx=Math.cos(i)*c,e.vy=Math.sin(i)*c,e.vz=l(-.1,.1),e.changeState(fe)}y=fe}if(qe===rt){if(y===de){Ie();return}}else if(y===fe){Ie();return}mt()}function Fo(){if(I!==ke&&I!==Be&&I!==Fe)for(let n=0;n<g[0];n++)for(let i=0;i<g[1];i++)for(let c=0;c<g[2];c++){let a;ue>0?a=new k(Y(-ue,ue),Y(-ue,ue),Y(-ue,ue),null,_,A,O,B[0],{x:1,y:1,z:1},0):a=new k((n-(g[0]/2>>0))*R[0]+(I===ct&&i%2===1?R[0]/2:0),(c-(g[2]/2>>0))*R[2],(i-(g[1]/2>>0))*R[1],null,_,A,O,B[0],{x:1,y:1,z:1},0),ge.push(a),Te(a,ie[0])}else if(I===ke){let n=5,i=n,c=n,a=100,t=12,h=5,f=.2,u=f*a;for(let x=0;x<a;x++){let p=x*t/a,m=n+h*p*Math.sin(p),r=n+h*p*Math.cos(p),E=f*x-u/2,S=-n/2,te=new k(i+S,E+S,c+S,null,_,A,O,B[0],{x:1,y:1,z:1},0);i=m,c=r,ge.push(te),Te(te,ie[0])}}else if(I===Fe){var o=!0;g[0]===2&&(o=!1);for(let n=0;n<g[0];n++)for(let i=0;i<g[1];i++)for(let c=0;c<g[2];c++){let a;a=new k((n-(g[0]/2>>0))*R[0]+(o?0:R[0]/2),0,(i-(g[1]/2>>0))*R[1]+(o?0:R[1]/2),null,_,A,O,B[0],{x:1,y:1,z:1},0),ge.push(a),Te(a,ie[0])}}else if(I===Be){let n=g[0]===4?1.25:2;for(let i=0;i<g[0];i++)for(let c=0;c<g[1];c++)for(let a=0;a<g[2];a++)if(Y(0,5)<n||i===parseInt(g[0]/2)&&a===parseInt(g[2]/2)&&c===parseInt(g[1]/2)){let t=new k((i-(g[0]/2>>0))*R[0]+Y(-R[0]*.2,R[0]*.2),(a-(g[2]/2>>0))*R[2]+Y(-R[2]*.2,R[2]*.2),(c-(g[1]/2>>0))*R[1]+Y(-R[1]*.2,R[1]*.2),null,_,A,O,B[0],{x:1,y:1,z:1},0);ge.push(t),Te(t,ie[0])}else continue}let e=999;for(let n=0;n<v;n++){let i=Ye[n],c=i.length,a=0;for(let t=0;t<c;t++)i[t].grow(n)||a++;a>0&&(n-=1)}z.sort(function(n,i){return Math.max(n.sizeX,n.sizeY,n.sizeZ)-Math.max(i.sizeX,i.sizeY,i.sizeZ)});let s=0;for(let n=0;n<z.length;n++){let i=z[n];s=Math.max(s,L(i.xp+i.sizeZ,2)+L(i.yp+i.sizeY,2)+L(i.zp+i.sizeZ,2))}xt=L(s,.5),be=xt,Uo(z.length),Go(),Kt()}function Go(){for(let s=0;s<z.length;s++){let n=z[s],i=320/ve;s<z.length*.15?i=40/ve:s<z.length*1/3&&(i=160/ve);for(let h of n.animation.stage){for(let f of Zo)h.targets[f]=n[f];h.speed=Xe}let c=n.animation.stage;c[de].speed=Xe,c[re].speed=Xe/4;let a=c[re].targets;if(a.rotX=a.rotY=a.rotZ=0,J.indexOf("bloom")>=0)Gt=.25,ze(a,0,0,0);else if(J==="side2side"){if(a.xp!==0)a.xp=400*Math.abs(a.xp)/a.xp;else{let h=w([-1,1]);Ee(a,400*Math.abs(h)/h,0,0)}ze(a,0,0,0)}else if(J==="top2bottom"){if(a.yp!==0)a.yp=400*Math.abs(a.yp)/a.yp;else{let h=w([-1,1]);Ee(a,0,400*Math.abs(h)/h,0)}ze(a,0,0,0)}else J==="insideout"&&(Ee(a,0,0,0),ze(a,0,0,0));c[ce].speed=Xe/4,ze(c[ce].targets,n.sizeX,n.sizeY,n.sizeZ);let t=c[de].targets;if(qe===Ae){var o=2*Math.PI*$(),e=Math.acos(2*$()-1);Ee(n,i*Math.sin(e)*Math.cos(o),i*Math.sin(e)*Math.sin(o),i*Math.cos(e))}else if(qe===Ht){let h=[0,0,0],f=$()*6<<0,u=f%3;h[u]=f>2?i:0,h[(u+1)%3]=$()*i,h[(u+2)%3]=$()*i,Ee(n,h[0]-i/2,h[1]-i/2,h[2]-i/2)}Ee(t,n.xp,n.yp,n.zp),n.vx=1+n.xp,n.vy=1+n.yp,n.vz=1+n.zp,n.animation.enabled=!0}}function bt(o,e){var s=o.indexOf(e);return s>-1&&o.splice(s,1),o}function Ce(o,e){for(let s=0;s<e.length;s++){let n=e[s],i=o,c=n;if(i===c)continue;let a=3;if(M(i.xp+i.sizeX/2,a)>M(c.xp-c.sizeX/2,a)&&M(i.xp-i.sizeX/2,a)<M(c.xp+c.sizeX/2,a)&&M(i.yp+i.sizeY/2,a)>M(c.yp-c.sizeY/2,a)&&M(i.yp-i.sizeY/2,a)<M(c.yp+c.sizeY/2,a)&&M(i.zp+i.sizeZ/2,a)>M(c.zp-c.sizeZ/2,a)&&M(i.zp-i.sizeZ/2,a)<M(c.zp+c.sizeZ/2,a))return!0}}function Vo(){if(Ke!==y)kt=We.getElapsedTime(),Qe=_e();else return;if(Ke=y,y===re)if(J==="outsidein"){me=!1,y=oe,me=!1;for(let o=0;o<ge.length;o++)ge[o].changeState(oe)}else y=Pe,me=!1,mt();if(y===Pe)if(y=ce,J==="insideout"||J==="side2side"||J==="top2bottom")me=!0;else if(J==="bloom-out"){me=!1;for(let o=0;o<ge.length;o++)ge[o].changeState(ce)}else J==="bloom-in"&&(me=!0)}function Kt(){requestAnimationFrame(Kt),j.render(ye,D),Ne.material.uniforms.time.value=We.getElapsedTime(),Ge.quaternion.copy(D.quaternion),X.updateMatrix();let o=(_e()-Qe)/1e3,e=1+z.length*o/Ze[y],s=0,n=[0,0,0,0,0,0,0,0,0],i=5,c=0,a=.01;for(let h=0;h<z.length;h++){let f=z[h];n[f.animation.state]++,me&&h<e&&f.changeState(y),!!f.animation.enabled&&(s++,f.step(),ee.position.set(M(f.xp,i)+f.id*c,M(f.yp,i)+f.id*c,M(f.zp,i)+f.id*c),f.visible?ee.scale.set(M(f.sizeX,i)-a,M(f.sizeY,i)-a,M(f.sizeZ,i)-a):ee.scale.set(0,0,0),ee.rotation.set(f.rotX,f.rotY,f.rotZ),ee.updateMatrix(),se.setMatrixAt(h,ee.matrix),se.setColorAt(h,f.color))}if(y!==fe&&y!==de&&n[oe]===z.length&&(y=oe),n[y]===z.length&&Vo(),s>0&&(se.instanceMatrix.needsUpdate=!0),!Le&&!Oe){Ve++;var t=(-D.zoom+be)/Vt;t>.045?t=.045:t<-.3&&(t=-.3),D.zoom+=t,Math.abs(D.zoom-be)<.1&&(G.enabled=!0),D.updateProjectionMatrix(),o=(_e()-Qe)/1e3,y===re||y===Pe||y===ce||y===oe?(G.autoRotate=!0,Ve<600&&!Oe&&!Le?G.autoRotateSpeed=.75+(12+-12*Ve/600):G.autoRotateSpeed=.75,y===oe&&(be+=(ht*2-be)/(3*60),o>6.5&&Ie())):y===de?(Ke&&o>7.5&&Ie(),G.autoRotate=!0,G.autoRotateSpeed=-2):y===fe&&(o>7.5&&Ie(),G.autoRotateSpeed=-2)}G.update()}function Qt(){D.aspect=st/at,D.updateProjectionMatrix(),j.setSize(st,at)}})();
