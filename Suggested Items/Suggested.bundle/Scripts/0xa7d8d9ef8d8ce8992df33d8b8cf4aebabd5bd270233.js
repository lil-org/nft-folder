let t=tokenData.hash,e=!1;const i=THREE;i.Cache.enabled=!0;const s="url(data:image/png;base64,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)";let n=[[24435,693142,9753277,15325350,15637248,13264642,12271107,11411474,10166822],[15087942,15858414,11066076,4553629,1914199],[2508371,2792847,15320170,16032353,15167313],[16764338,16757922,15046811,11895693,7170165],[12361,14034984,16219904,16564041,15393463],[9358054,2203324,143431,16758531,16483584],[198430,3606039,6947855,10289672,13631488,14429954,15228164,16026630,16425735,16759304],[3365991,16774064,14720830,10365483,5507854],[16052702,14711391,4014171,8499866,15912079],[5836066,8392495,10752828,13178954,16731501,16741775,16748451,16757697,16764117,16773363],[5412,1401197,16772305,16743680,7874831],[16170336,16248290,16108227,8693149,15893634],[3494e3,7166330,11887990,15035247,15379595],[7864320,12653087,16642261,12361,6724540],[4603706,9077116,12368049,16053230,14725024],[5453639,6246507,6974339,7771295,8829885],[15246744,16758183,16696763,16569806,16441821,16313835,16377304,16374980,16569007,16697498,267551,1587767,15718060,12863744,4400436],[10724224,14077587,15723470,14197903,12289416],[14508362,16025192,16033432,12960658,7579008],[16369678,16279076,15349062,6696603,4439245],[3620689,36309,14662577,16082038,14958447],[867174,16445642,16044894,15636043,16340792],[15713947,11475775,4665668,13416091,14654317],[13224867,16769448,14839132,7486790,4664624],[5523787,15857645,9553841,11745617,14930049],[6581880,9279655,14470331,15381604,10974541],[867174,16445642,16044894,15636043,261452672],[9456759,14981808,15513765,15519683,9797013],[8370110,13890542,14339134,12332058,8197432],[15922896,13689300,14275254,14991006,7432570],[13224867,16769448,14839132,7486790,4664624],[5941734,8374520,16382457,16770142,16737170],[2508371,2792847,15320170,16032353,15167313],[16575689,16560307,16333123,8303325,4480659],[5263695,15884124,16769126,2390944,7389619],[16764338,16757922,15046811,11895693,7170165],[5794724,3294070,16113040,16158303,16215134],[15559258,16052667,10207676,6117227,15133664],[3290939,4872281,16045772,16037984,13123149],[7811908,14923172,16116194,720916,13913436],[1659743,752245,14141866,8072486,15791093],[7226623,12096255,16761570,16748723,15694469],[8931727,7839649,14732200,16737602,5652820]];const l="precision highp float;varying vec3 vC;varying float trans;varying float tI;varying vec3 nXY;uniform float transToggle;uniform sampler2D map;float random(vec2 p){return fract(cos(dot(p,vec2(23.14069263277926,2.665144142690225)))*12345.6789);}float gt(float x,float y){return max(sign(x-y),0.0);}void main() {vec4 ss = texture2D(map, vec2(nXY.x*0.25+0.25 * tI,nXY.y));vec3 nc=mix(vC,vC*0.96,nXY.y);",o="gl_FragColor=vec4(nc.xyz,trans * mix(1.,pow(ss.x,.5),transToggle));if(ss.x < 0.35){discard;}}";function a(t=0,e=0,s=0){return new i.Vector3(t,e,s)}function h(t=0,e=0){return new i.Vector2(t,e)}function r(){return i.Math}function c(t=0,e=0,s=0){return new i.Color(t,e,s)}function d(t=0){return new i.Color(t)}const p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let t=0;t<256;t++)p[256+t]=p[t];function f(t){return t*t*t*(t*(6*t-15)+10)}function u(t,e,i){return e+t*(i-e)}function m(t,e,i,s){const n=15&t,l=n<8?e:i,o=n<4?i:12==n||14==n?e:s;return(0==(1&n)?l:-l)+(0==(2&n)?o:-o)}class g{noise(t,e,i){const s=Math.floor(t),n=Math.floor(e),l=Math.floor(i),o=255&s,a=255&n,h=255&l,r=(t-=s)-1,c=(e-=n)-1,d=(i-=l)-1,g=f(t),x=f(e),y=f(i),w=p[o]+a,v=p[w]+h,S=p[w+1]+h,M=p[o+1]+a,b=p[M]+h,A=p[M+1]+h;return u(y,u(x,u(g,m(p[v],t,e,i),m(p[b],r,e,i)),u(g,m(p[S],t,c,i),m(p[A],r,c,i))),u(x,u(g,m(p[v+1],t,e,d),m(p[b+1],r,e,d)),u(g,m(p[S+1],t,c,d),m(p[A+1],r,c,d))))}}let x,y,w,v,S,M,b,A,L,z;const k=Math.PI;let P,C,F,H,W,O,E,R,D,B,T=window.innerWidth/2,G=window.innerHeight/2,q=h(),Y=[],I=[],j=[],U=[],V=[],X=[],J=[],Q=[],N=0,Z=0,K=0,_=0,$=0,tt=.016667,et=0,it=0,st=0,nt=0,lt=0,ot=.035,at=60,ht=0,rt=0,ct=0,dt=1e3,pt=0,ft=0,ut=0,mt=0,gt=1,xt=0,yt=0,wt=0,vt=1,St=!1,Mt=!1,bt=!1,At=!0,Lt=!1,zt=!1,kt=!1,Pt=!1,Ct=!1,Ft=c(.25,.25,.25),Ht=d(14723862);const Wt=window.devicePixelRatio;let Ot,Et,Rt,Dt,Bt,Tt,Gt,qt,Yt,It,jt,Ut,Vt=0,Xt=0,Jt=0,Qt=0,Nt=[],Zt=[],Kt=[],_t=[],$t=[];class te{constructor(){this.useA=!1;let t=function(t){let e=parseInt(t.substr(0,8),16),i=parseInt(t.substr(8,8),16),s=parseInt(t.substr(16,8),16),n=parseInt(t.substr(24,8),16);return function(){e|=0,i|=0,s|=0,n|=0;let t=(e+i|0)+n|0;return n=n+1|0,e=i^i>>>9,i=s+(s<<3)|0,s=s<<21|s>>>11,s=s+t|0,(t>>>0)/4294967296}};this.prngA=new t(tokenData.hash.substr(2,32)),this.prngB=new t(tokenData.hash.substr(34,32));for(let t=0;t<1e6;t+=2)this.prngA(),this.prngB()}random_dec(){return this.useA=!this.useA,this.useA?this.prngA():this.prngB()}}function ee(){var t,e,i=0;return Object.freeze({enqueue(s){const n={value:s,next:void 0};e=t?e.next=n:t=n,i++},dequeue(){if(t){const e=t.value;return t=t.next,i--,e}},peek:()=>t?.value,getCount:()=>i})}let ie=new ee,se=new ee;class ne{constructor(){this.p,this.mS,this.f,this.c,this.r,this.dO,this.dE,this.ss}}class le{constructor(t,e,i,s){this.mP=i,this.nL=0,this.o=e.clone(),this.hP=e.clone(),this.v=a(),this.s=t,this.cL=0,this.pC=0,this.h=s,this.sM=1,this.nA=1,this.rF=a(ye(0,1),ye(0,1),ye(0,1)),this.m,this.loop0=a(),this.loop1=a(),this.cc=c()}aP(t){if(this.nL>=1)return;const s=this.s;let n=!1;if(s.sSk){let t=Math.pow(Math.sin(.5*this.nL*k),.5),e=Math.round(r().lerp(52,.8,t));this.pC%e==0&&0!=this.pC||(n=!0)}var l=at<7?4:at<17?3:at<27?2:1;if(0==Math.floor(this.pC%s.sk)&&!n&&this.pC%l==0){this.loop0.set(0,0,0),this.loop1.set(0,0,0),t.add(this.loop0.set(ye(-.0075,.0075),ye(-.01,.01),ye(-.01,.01)));let n=t.clone();s.m.localToWorld(n);let l=Ot.clone(),o=.5*(de(n,2,1,1e3,l)+1),h=Math.pow(r().clamp(o+.1,0,1),4)*this.nA*Et,d=de(n,4,2,1e3,l.multiplyScalar(.5));if(n.add(a(Math.cos(d*k)*h*.2,Math.sin(d*k)*h*.125,Math.sin(d*k)*h*.05)),t.set(n.x,n.y,n.z),s.prj){let e=function(t,e,i,s){let n=a().subVectors(s,t),l=i.dot(n),o=i.dot(e),h=a();if(0!=o){let i=l/o,s=e.clone().multiplyScalar(i);h=t.clone().add(s)}return h}(t,a().subVectors(t,z).normalize(),this.loop0.set(0,0,1),this.loop1.set(0,0,-20));e.lerp(t,.1),t.set(e.x,e.y,e.z)}t.add(this.loop0.set(Bt,0,0)),t.add(this.loop0.set(0,0,ye(-.005,.005)));let p=ye(Rt[0],Rt[1],Rt[2]),f=ye(Dt[0],Dt[1],Dt[2]),u=new i.Vector4(p,f,1).multiplyScalar(1-.5*qe(this.nL,1,3,!0)+.5).multiplyScalar(this.sM),m=[ye(0,1),ye(0,1),ye(0,1),de(t,2,1,1,s.lRF)],g=function(t,e){e=r().clamp(e,0,.99999);let i=1/(t.length-1),s=e/i,n=Math.floor(s),l=s-n;if(null==t[n]||null==t[n+1])return ve;return we.setRGB(t[n].r,t[n].g,t[n].b),we.lerp(t[n+1],l),we}(s.colors,this.cL);this.cc.setRGB(g.r,g.g,g.b);let x=(g.r+g.g+g.b)/3,y=r().lerp(1,.875,x),w=r().lerp(1.125,1,x);if(this.cc.multiplyScalar(ye(y,w)),St){let t=1.15;this.cc=c(Math.pow(g.r,t),Math.pow(g.g,t),Math.pow(g.b,t))}if(mt>0)Nt.push(t.x),Nt.push(t.y),Nt.push(t.z),Zt.push(u.x),Zt.push(u.y),Zt.push(u.z),Zt.push(s.prj||s.ss?0:1),Kt.push(0),Kt.push(1),Kt.push(0),Kt.push(0),_t.push(this.cc.r),_t.push(this.cc.g),_t.push(this.cc.b),_t.push(xe(0,3.999)),$t.push(s.ss?1:0),$t.push(m[1]),$t.push(m[2]),$t.push(m[3]),et++;else{let i=new ne;i.p=t,i.mS=u.set(u.x,u.y,u.z,s.prj||s.ss?0:1),i.dO=e?0:s.dissolveOffset,i.dE=e?0:s.dissolveEnabled,i.c=[this.cc.r,this.cc.g,this.cc.b,xe(0,3.999)],i.ss=s.ss?1:0,i.r=[m[0],m[1],m[2],m[3]],ie.enqueue(i),At=!1}}this.pC++,this.nL=this.pC/this.mP}aFO(t){this.v.multiplyScalar(.925),t.multiplyScalar(1-qe(this.nL,1,8,!0)),this.v.add(t.multiplyScalar(.016667)),this.hP.add(this.v),this.aP(this.hP.clone())}mHP(t){this.hP.set(t.x,t.y,t.z),this.aP(this.hP.clone())}}let oe=0;class ae{constructor(t,e,s,n,l,o,h,r,c,d,p=!1){this.par=s,this.mP=r,this.h=l,this.sh=[],this.dSh=[],this.nS=n,this.ySw=.5,this.sSk=!1,this.prj=!1,this.ss=p,this.ty=e,this.rrvs=o,this.gRF=Ot,this.lRF=a(ye(0,1),ye(0,1),ye(0,1)),this.sk=d,this.colors=h,this.raClr=!1;const f=this.mP*this.nS;var u;$+=f/this.sk,this.m=new i.Object3D,this.m.frustumCulled=!0,this.v2S,this.normalizedLife=0,this.par.add(this.m),this.dissolveOffset=1,this.dissolveEnabled=0,this.sizeMod=1,this.isDead=!1,this.misc,this.noiseAffect=1,ut++,this.objectCount=ut,this.nSC=mt>0?this.nS:1,this.cmn=a(),this.loop0=a(),this.loop1=a(),this.priority=mt>0?0:t,(u=this.priority)<dt&&(dt=u)}cLS(t){let e=new le(this,t,this.mP,this.h);this.sh.push(e)}can(){return this.sh.length<this.nS}gOrc(){for(let t=0;t<this.nSC;t++)if(this.can()){let t=1/this.nS*this.sh.length,e=this.sh.length,i=.35*(1-qe(t,this.rrvs[3],.25,!1)),s=1/this.nS*e;e%2==0&&(this.ySw=-1*this.ySw);let n=this.cmn.set(0,this.ySw*s,i).multiplyScalar(this.h);this.cLS(n)}for(let t=0;t<this.sh.length;t++){let e=mt>0?100:1;for(let i=0;i<e;i++){let e=this.sh[t],i=this.sh[t].nL;if(this.ckD(e))continue;let s=Math.pow(r().clamp(i/.15,0,1),.25),n=fe(this.loop0.set(Math.abs(e.hP.x),e.hP.y,e.hP.z),this.rrvs[0],this.rrvs[1],this.rrvs[2],1e4,this.gRF),l=this.loop0.set(Math.sin(n[0])*n[1]," "*n[1],0),o=t%2==0?-l.x:l.x,h=this.loop1.set(o,l.y,.5*n[1]),c=t%2==0?5:-5;c*=.5*this.rrvs[1],c*=qe(e.o.y+.5,2,1,!0);let d=this.loop0.set(c,-.05,.15),p=a();p.lerpVectors(d,h,s).multiplyScalar(this.h),e.cL=e.nL,e.sM=this.sizeMod,e.aFO(p)}}}gPp(){for(let t=0;t<this.nSC;t++)this.can()&&this.cLS(this.cmn);for(let t=0;t<this.sh.length;t++){let e=mt>0?100:2;for(let i=0;i<e;i++){let e=this.sh[t];this.sh[t].nL;if(this.ckD(e))continue;let i,s,n=e.pC/this.mP*2*k-.1*t,l=Math.pow(e.pC/this.mP,2)*this.h,o=this.loop0.set(Math.cos(n),Math.sin(n),l),a=Math.pow(e.pC/this.mP,1),h=de(o,2,.35,1e4,this.lRF)*a,r=de(o,3,.1,1e4,this.lRF)*a;t%2==0?(i=.475*Math.pow(e.pC/this.mP,.5)+h,s=l+r):(i=.11*(1-Math.pow(e.pC/this.mP,2)),s=.35*l);let c=this.loop1.set(Math.cos(n)*i,Math.sin(n)*i,s).multiplyScalar(this.h);e.cL=Math.pow(e.nL,2),e.sM=this.sizeMod,e.mHP(c)}}}gPe(t){for(let t=0;t<this.nSC;t++)if(this.can()){let t=this.sh.length/this.nS,e=(this.sh.length,this.nS,.1*qe(t,1,.5,!1)),i=this.cmn.set(0,0,e).multiplyScalar(this.h);this.cLS(i)}a(),a();for(let e=0;e<this.sh.length;e++){let i=mt>0?100:8;for(let s=0;s<i;s++){let i=this.sh[e],s=this.sh[e].nL;if(this.ckD(i))continue;let n,l,o,a,h,r,c=1-qe(s,2,2,!1),d=Math.pow(s,.65),p=de(this.loop0.set(-s,-s,-s),2,.05,1e3*e,i.rF);3==t?(n=e/this.nS*.55+.1,l=0,o=.1,a=.2,h=.25*(1-e/this.nS)*-k,r=c):4==t?(n=.425*qe(e/this.nS,2,.5,!0)+.225,l=.1,o=.025,a=.25,h=.6*(1-e/this.nS)*-k+.25*k,r=c):5==t&&(n=e/this.nS*.3+.5,l=.05,o=.225*(1-e/this.nS)+.05,a=.5*(1-e/this.nS)+.15,h=.1*Math.round(e/this.nS*10)*.45*-k,r=d);let f=(5==t?r:s)*n+p,u=de(this.loop0.set(s,s,s),2,l,1e3*e,i.rF),m=r*o*Math.sin(300*s)+u,g=de(this.loop0.set(s,s,s),2,.035,100*e,i.rF),x=Math.pow(s,4)*a*i.rF.y+i.o.z+g,y=this.loop1.set(f,m,x);y.applyAxisAngle(this.loop0.set(0,1,0),h),y.applyAxisAngle(this.loop0.set(0,0,1),(2*this.lRF.x*k+e%8==0?2*i.rF.z*k:.35*e*k)+2*this.lRF.y*k).multiplyScalar(this.h),i.cL=Math.pow(i.nL,4),i.sM=this.sizeMod*(5==t?Math.pow(1-i.nL,.1):1),i.mHP(y)}}}gSF(){for(let t=0;t<this.nSC;t++)if(this.can()){this.cLS(this.cmn);for(let t=this.colors.length-1;t>0;t--)this.colors[t]=ge(Ht,-1,.1,.2).multiplyScalar(this.sh.length/this.nS*.2+.9)}for(let t=0;t<this.sh.length;t++){let e=mt>0?100:8;for(let i=0;i<e;i++){let e,i=this.sh[t],s=this.sh[t].nL;if(this.ckD(i))continue;if(t>1){let n=.1*qe(s,2,!0,4)*this.h,l=ye(-n,n,.65),o=t/(this.nS-1)*4*k+(.4*k*i.rF.y-.2*k),a=s*this.h*.5,h=.1*i.rF.z*this.h+.15*Math.pow(s,4)*this.h*i.rF.x;if(e=this.loop0.set(a,l,h),e.applyAxisAngle(this.loop1.set(0,0,1),o),i.cL=.05*(t/this.nS*.5+.4)+.95*s,i.sM=.8*this.sizeMod,this.isDead)for(let t=this.colors.length-1;t>0;t--)this.colors[t]=Ft;else if(St)for(let t=this.colors.length-1;t>0;t--){let e={h:0,s:0,l:0};this.colors[t].getHSL(e),this.colors[t].setHSL(e.h,0,e.l)}}else{let t=ye(0,2)*k,s=.25*ye(0,1,.5)*this.h;if(e=this.loop0.set(Math.cos(t)*s,Math.sin(t)*s,ye(.1*this.h,.15*this.h)),i.cL=0,i.sM=1.1*this.sizeMod,this.isDead)this.colors[0]=Ft;else if(this.colors[0]=ge(this.colors[1].clone().multiplyScalar(.5)),St){let t={h:0,s:0,l:0};this.colors[0].getHSL(t),this.colors[0].setHSL(t.h,0,t.l)}}let n=this.loop0.set(e.x,e.y,e.z);i.mHP(n),i.nA=.65}}}gHy(){for(let t=0;t<this.nSC;t++)this.can()&&(this.cLS(this.cmn),this.sh[this.sh.length-1].misc=ue(.55*this.h*ye(.25,1,.5)),this.sh[this.sh.length-1].misc.multiply(a(.3*this.lRF.x+.8,.3*this.lRF.y+.8,1)),this.sh[this.sh.length-1].misc.multiply(a(1,1,.5)),this.sh[this.sh.length-1].misc.add(a(0,0,.1*this.h)));for(let t=0;t<this.sh.length;t++){let e=mt>0?100:6;for(let i=0;i<e;i++){let e=this.sh[t];this.sh[t].nL;if(this.ckD(e))continue;let i=ue(.015*e.rF.x+.015);0!=t&&i.add(e.misc),e.cL=t/this.nS,e.mHP(i),e.sM=.9,e.nA=.75}}}gS(){for(let t=0;t<this.nSC;t++)if(this.can()){let t=this.sh.length/(this.nS-1)*k*2,e=this.par.worldToLocal(a(0,-.7,0)),i=.01*Math.cos(t)*this.h,s=0,n=.01*Math.sin(t)*this.h,l=this.cmn.set(i+e.x,s+e.y,n+e.z);this.cLS(l)}for(let t=0;t<this.sh.length;t++){let e=mt>0?100:2;for(let i=0;i<e;i++){let e=this.sh[t],i=this.sh[t].nL,s=qe(i,1,.2,!0);if(this.ckD(e))continue;let n=qe(e.nL,2,1,!0),l=t/(this.nS-1)*k*2,o=this.loop0.set(.1*Math.cos(l)*this.h*Math.pow(i,8),.1*Math.sin(l)*this.h*Math.pow(i,8),-.015),h=.1*this.lRF.z+.6,r=i>h&&t%5==0;if(this.lRF.y>.25&&r){let t=a(this.lRF.z<.5?.1:-.1,-.1,-.2);o=a().lerpVectors(o,t,(i-h)/(1-h))}let c=e.o,d=ke(e.o,c,c,o,s),p=fe(this.loop1.set(e.nL+100*this.lRF.x,e.nL,e.nL),.5,.25,4,1e4,this.lRF),f=this.loop0.set(Math.sin(p[0])*p[1],Math.cos(p[0])*p[1],0),u=this.loop1.set(f.x,.25*f.y,-.2).multiplyScalar(n);e.cL=r?0:e.nL,e.mHP(d.add(u)),e.sM=(r?.9:.75)*this.sizeMod}}}rPs(){let t=this.rrvs;return a(Math.pow(ye(0,1),t[1])*t[0]-.5*t[0],Math.pow(ye(0,1),t[3])*t[2]-.5*t[2],Math.pow(ye(0,1),t[5])*t[4]-.5*t[4])}gPl(){for(let t=0;t<this.nSC;t++)if(this.can()){let t=this.rPs();this.cLS(t)}for(let t=0;t<this.sh.length;t++){let e=mt>0?100:1;for(let i=0;i<e;i++){let e=this.sh[t],i=this.sh[t].nL;if(this.ckD(e))continue;let s=this.rPs().multiplyScalar(this.h);this.raClr?e.cL=i:e.cL=r().clamp(Math.pow(Math.abs(s.x)/(.5*this.rrvs[0]),3)+Math.pow(Math.abs(s.z)/(.5*this.rrvs[4]),3),0,1),e.mHP(s)}}}rPl(){let t=this.rrvs,e=Math.pow(ye(0,1),t[3]),i=r().lerp(0,t[1]*t[2],e),s=r().lerp(t[1]*t[2],t[1],e),n=Math.pow(ye(i,s),1),l=ye(0,t[0]*k),o=null!=t[4]?t[4]:0;return a(Math.cos(l)*(n+o),Math.sin(l)*(n+o),0)}gSC(){for(let t=0;t<this.nSC;t++)if(this.can()){let t=this.rPl();this.cLS(t)}for(let t=0;t<this.sh.length;t++){let e=mt>0?100:1;for(let i=0;i<e;i++){let e=this.sh[t],i=this.sh[t].nL;if(this.ckD(e))continue;let s=this.rPl().multiplyScalar(this.h);if(this.raClr)e.cL=i;else{let t=Math.pow(h(s.x,s.y).length()/(this.rrvs[1]*this.h),2);e.cL=t}e.mHP(s),e.sM=this.sizeMod}}}gRO(){for(let t=0;t<this.nSC;t++)this.can()&&this.cLS(this.cmn);for(let t=0;t<this.sh.length;t++){let e=mt>0?100:1;for(let i=0;i<e;i++){let e=this.sh[t];this.sh[t].nL;if(this.ckD(e))continue;let i=xe(0,this.v2S.count-1),s=this.loop0;s.fromBufferAttribute(this.v2S,i),s.multiplyScalar(this.h);let n=(h(s.x,s.z).length()-this.rrvs[0])/(this.rrvs[1]-this.rrvs[0]);e.cL=n,e.nA=this.noiseAffect,e.sM=this.sizeMod,e.mHP(s)}}}gSk2(){for(let t=0;t<this.nSC;t++)this.can()&&this.cLS(this.cmn);for(let t=0;t<this.sh.length;t++){let e=mt>0?100:1;for(let i=0;i<e;i++){let e=this.sh[t];this.sh[t].nL;if(this.ckD(e))continue;let i=this.loop0,s=xe(0,this.v2S.count-1);i.fromBufferAttribute(this.v2S,s),i.multiplyScalar(this.h),i.x*=.85,i.y*=.95,i.z*=.95;let n=1;if(i.y<.175){let t=.175-i.y;i.y+=.35*t,t=.175-i.y;let e=r().clamp(t/.1,0,1);n=r().lerp(1,.65,e)}if(ye(0,1)<.25){let t=.025,e=.25;i.y=ye(t,e),i.z=ye(.15,.185),n=1;let s=r().lerp(.05,.125,(i.y-t)/(e-t));i.x=ye(-s,s)}let l=.075,o=.155;if(i.x<-.035&&i.x>-.125&&i.y>.165&&i.y<.21&&i.z>0)e.cL=0,e.sM=.75,i.z+=.02;else if(i.x>.035&&i.x<.125&&i.y>.165&&i.y<.21&&i.z>0)e.cL=0,e.sM=.75,i.z+=.02;else if(i.y>l&&i.y<o&&i.z>0){let t=r().lerp(.02,0,(i.y-l)/(o-l));i.x>-t&&i.x<t?(e.cL=0,e.sM=.75,i.z+=.02):e.cL=1*n}else e.cL=1*n;i.y-=.05,e.nA=0,e.mHP(i)}}}gBk(){for(let t=0;t<this.nSC;t++)if(this.can()){let t=this.rPs();this.cLS(t)}for(let t=0;t<this.sh.length;t++){let e=mt>0?100:1;for(let i=0;i<e;i++){let e=this.sh[t];this.sh[t].nL;if(this.ckD(e))continue;let i=this.rPs();if(i.x<.5*this.rrvs[0]-.03){let t=Math.sign(i.y);i.set(i.x,r().clamp(3*Math.abs(i.y),0,.5*this.rrvs[2])*t,i.z)}let s=.5*this.rrvs[2];i.y>.02-s&&i.y<s-.02&&i.x<.5*this.rrvs[0]-.03?e.cL=1:e.cL=0,e.nA=.25,e.mHP(i)}}}gHi(){for(let t=0;t<this.nSC;t++)this.can()&&this.cLS(this.cmn);for(let t=0;t<this.sh.length;t++){let e=mt>0?100:16;for(let i=0;i<e;i++){let e,i=this.sh[t],s=this.sh[t].nL;if(!this.ckD(i)){if(t<5){let n=Math.pow(s,.9),l=t/(this.nS-1)*.1+.45,o=.05,a=.175,h=.75*(i.rF.x-.5),r=t/(this.nS-1)*-2*k,c=s*l,d=de(this.loop0.set(s,s,s),2,o,1e3*t,i.rF),p=n*a*Math.sin(300*s)+d,f=de(this.loop1.set(s,s,s),2,.035,100*t,i.rF),u=qe(p/.175,3*i.rF.x,1,!1),m=Math.pow(s,4)*h*i.rF.y+i.o.z+f+(.05*u-.025);e=this.loop0.set(c,p,m),e.applyAxisAngle(this.loop1.set(0,1,0),t/(this.nS-1)*-.1*k),e.applyAxisAngle(this.loop1.set(0,0,1),r+2*this.lRF.y*k).multiplyScalar(this.h),i.cL=Math.pow(i.nL,3)}else e=this.loop0.set(Math.pow(s,2)*i.rF.z*.1,0,.15*s),i.cL=Math.pow(s,2);i.sM=this.sizeMod*Math.pow(1-i.nL,.1),i.nA=.9,i.mHP(e)}}}}ckD(t){const e=this.sh.length==this.nS&&t.nL>=1&&this.dSh.indexOf(t)<0;return e&&this.dSh.push(t),e}create(){if(this.dSh.length<this.nS){if(this.priority>oe)return;switch(this.ty){case 0:this.gS();break;case 1:this.gOrc();break;case 2:this.gPp();break;case 3:case 4:case 5:this.gPe(this.ty);break;case 6:this.gSC();break;case 7:this.gPl();break;case 8:this.gRO();break;case 9:this.gSk2();break;case 10:this.gSF();break;case 11:this.gHy();break;case 12:this.gBk();break;case 13:this.gHi()}}this.sh.length==this.nS&&(this.normalizedLife=this.sh[this.nS-1].nL)}}class he{constructor(t,e,i,s,n,l,o){this.type=e,this.height=i,this.bulb=[],this.stem=[],this.currentFrame=0,this.index=t,this.colors=s,this.randomVars=n,this.dissolveEnabled=1,this.dissolveOffset=ye(900,2700),this.isDead=l,this.container=o,b.add(this.container)}createStem(){let t=new i.Object3D;this.container.add(t);let e=new ae(6+2*Math.floor(.5*rt),0,t,8,this.height,null,this.colors[0],128,!1,1);return e.dissolveOffset=this.dissolveOffset,e.dissolveEnabled=this.dissolveEnabled,e}createBulb(){let t,e,s,n=new i.Object3D;this.container.add(n);let l=!1;switch(this.type){case 1:t=256,e=64,s=2;break;case 2:t=128,e=256,s=2;break;case 3:t=32,e=1900,s=3,l=!0;break;case 4:t=128,e=460,s=2,l=!0;break;case 5:t=32,e=1900,s=2,l=!0;break;case 10:t=xe(20,30.999),e=200,s=1;break;case 11:t=xe(128,128),e=225,s=1;break;case 13:t=6,e=1024,s=1}let o=new ae(7+2*Math.floor(.5*rt),this.type,n,t,this.height,this.randomVars,this.colors[1],e,!0,s);return o.sSk=l,o.dissolveOffset=this.dissolveOffset,o.dissolveEnabled=this.dissolveEnabled,o.isDead=this.isDead,this.isDead&&(o.sizeMod=.35),n.position.set(0,0,0),o}create(){rt++;let t=this.createStem(),e=this.createBulb();V.push(t),V.push(e)}}class re{constructor(t,e,i,s,n,l,o,a){this.position=t,this.height=e,this.minWidth=i,this.maxWidth=5!=a?s*this.height:s,this.radius=5!=a?this.minWidth+this.maxWidth:.65*(this.minWidth+this.maxWidth),this.radius=6!=a?this.radius:.65*e,this.period=n,this.power=l,this.randoms=o,this.index=a}}let ce=a();function de(t,e,i,s,n){let l=ce.set(t.x,t.y,t.z).multiplyScalar(e);return l.add(a(n.x*s,n.y*s,n.z*s)),P.noise(l.x,l.y,l.z)*i}let pe=a(-.5,-.5,-.5);function fe(t,e,i,s,n,l){let o=de(t,e,1,n,l),a=de(t.clone().multiplyScalar(-1),e,i,n,l.clone().add(pe));return o=o*s*k,a=.5*(a+1)*i,[o,a]}function ue(t,e=!1){var i=e?Math.random():ye(0,1),s=e?Math.random():ye(0,1),n=2*k*i,l=Math.acos(2*s-1);return a(t*Math.sin(l)*Math.cos(n),t*Math.sin(l)*Math.sin(n),t*Math.cos(l))}function me(){let t=ye(5,20);St&&(t=0);let e=function(t){let e=c().setHSL(t[0]/360,t[1]/100,t[2]/100);return[e.r,e.g,e.b]}([ye(30,130),t,ye(30,50)]);return c(e[0],e[1],e[2])}function ge(t,e=-1,s=.1,n=.3){let l;return l=typeof t!=typeof i.Color?new i.Color(t):t.clone(),e<0?l.lerp(I[xe(0,I.length-.001)],ye(s,n)):l.lerp(I[e],ye(s,n)),l}function xe(t,e,i){return Math.floor(ye(t,e,i))}function ye(t,e,i=1){let s=W.random_dec();return Math.pow(s,i)*(e-t)+t}let we=c(),ve=c(1,1,1);let Se=a(),Me=a(),be=a(),Ae=a(),Le=a(),ze=a();function ke(t,e,i,s,n){return Se=Se.lerpVectors(t,e,n),Me=Me.lerpVectors(e,i,n),be=be.lerpVectors(i,s,n),Ae=Ae.lerpVectors(Se,Me,n),Le=Le.lerpVectors(Me,be,n),ze.lerpVectors(Ae,Le,n)}function Pe(t,e,i,s=!0){let n=[],l=[],o=k*(3-Math.sqrt(5));a(0,-1e4,0),a(0,1e4,0);for(let s=0;s<t;s++){let h=1-s/(t-1)*2,r=Math.sqrt(1-h*h),c=o*s+e,d=a(Math.cos(c)*r,h,Math.sin(c)*r);d.applyAxisAngle(a(1,0,0),i),n.push(d),l.push(d)}return l.sort((function(t,e){return t.y-e.y})),s&&(Ce(n,l[0]),Ce(n,l[1]),Ce(n,l[l.length-1])),n}function Ce(t,e){const i=t.indexOf(e);i>-1&&t.splice(i,1)}function Fe(t){let e=[],i=new re(t,ye(.15,.2),0,ye(.5,.55),2,ye(.1,.3),[ye(-.1*k,.1*k),ye(-.1*k,.1*k)],0),s=new re(t,ye(.15,.25),ye(.025,.1),ye(.5,1),1,ye(.2,.5),[0,0],1),n=new re(t,ye(.425,.425),0,ye(.475,.475),2,ye(.25,.25),[ye(-.05*k,-.1*k),ye(-.2*k,.2*k),ye(-0*k,0*k)],4),l=new re(t,ye(.15,.175),ye(.05,.05),ye(2,2),1,ye(.2,.5),[0,0],3),o=new re(t,ye(.1,.165),.3,ye(0,.1),0,1,[0,0],5),a=new re(t,ye(.75,.75),0,ye(.125,.15),1,6,[0,0],2),h=new re(t,ye(.45,.45),0,ye(.09,.12),1,6,[0,0],6);e.push(i),e.push(o),e.push(l),e.push(s),e.push(a),e.push(h);let r=e[xe(0,e.length-1e-4,1.2)];return ye(0,100)<4*(1+4.15*xt)&&(r=n),r}function He(t,e=-.715){let s;if(4!=t.index&&5!=t.index){let t=Te();s=[Oe(t),t]}else 4==t.index?s=[ge(d(3355443)),ge(d(15658734),-1,.05,.15)]:5==t.index&&(s=[Oe(Te(),.75),ge(d(15658734))]);if(5!=t.index){const n=[];let l=t.height,o=t.minWidth,r=t.maxWidth,c=32,d=t.period,p=t.power,f=2!=t.index?1.5:.2;f=6!=t.index?f:.2;let u=l/c;for(let e=0;e<=l;e+=u){let i=qe(e/l,d,p,!0,f);2==t.index&&e/l<.25&&(i=1),6==t.index&&e/l<.1&&(i=1),n.push(h(o+i*r,e))}let m=new i.LatheGeometry(n,64),g=(new i.BufferGeometry).fromGeometry(m),x=g.attributes.position;if(3==t.index){let e=xe(1,4.999),i=ye(0,2*k),s=.15;for(let n=0;n<e;n++){let e=(i+2*k*.333*n)%(2*k),l=a(Math.cos(e)*s,-.665,Math.sin(e)*s).add(a(t.position.x,0,t.position.z));3==n&&(l=a(0,-.565,0).add(a(t.position.x,0,t.position.z)));let o=l.y;He(new re(l,ye(.15,.15),0,ye(.5,.5),2,ye(.1,.3),[ye(-.1*k,.1*k),ye(-.1*k,.1*k)],0),o)}}if(6==t.index)for(let t=0;t<3*g.attributes.position.count;t+=3){let e=g.attributes.position.array[t+1]/l,i=qe(1-e,1.8,1.2,!1,.25),s=a(g.attributes.position.array[t],g.attributes.position.array[t+1],g.attributes.position.array[t+2]);if(s.set(s.x+(.14*i-.07),s.y,s.z),e<.1||t%8==0){let t=ue(.06,!0);s.set(t.x-.01,t.y+.09,t.z),s.z>-.025&&s.z<.025&&s.y<.125&&s.y>.055&&s.set(-.05,.1,0)}s.applyAxisAngle(a(0,0,1),.45*k),g.attributes.position.array[t]=s.x,g.attributes.position.array[t+1]=s.y,g.attributes.position.array[t+2]=s.z}let y=We(5,4==t.index?9:8,4==t.index?64:0!=t.index?48:32,0==t.index?64:128,1,6==t.index?[0,.35*l]:[o,o+r],[s[0],s[1]],!0,[t.randoms[0],6==t.index?ye(0,2*k):0,t.randoms[1]],[t.position.x,6==t.index?-.66:e,t.position.z],b,2);y.v2S=x,y.noiseAffect=.75,2==t.index&&(y.noiseAffect=.15),6==t.index&&(y.noiseAffect=.15,y.sizeMod=.5)}else{let e=t.minWidth+t.maxWidth;We(5,12,32,128,1,[e,1,t.height,1,1.333*e,1],[s[0],s[1]],!0,[0,ye(0,2)*k,0],[t.position.x,-.64,t.position.z],b,1)}return t}function We(t,e,s,n,l,o,a,h,r,c,d,p,f=!1,u=!1,m=!1){let g=new i.Object3D,x=new ae(t,e,g,s,l,o,a,n,h,p,m);return x.raClr=f,x.prj=u,g.rotation.set(r[0],r[1],r[2]),g.position.set(c[0],c[1],c[2]),d.add(g),V.push(x),x}function Oe(t,e=.4){let i,s=c(t.r,t.g,t.b),n={h:0,s:0,l:0};return s.getHSL(n),i=s.clone().setHSL(n.h,n.s,r().clamp(n.l*e,0,1)),i}function Ee(t,e=.15){let i,s=c(t.r,t.g,t.b),n={h:0,s:0,l:0};return s.getHSL(n),i=St?s.clone().setHSL(n.h,0,r().clamp(n.l+r().lerp(e+.1,0,n.l),0,1)):s.clone().setHSL(n.h,r().clamp(n.s+.15,0,1),r().clamp(n.l+e,0,1)),i}function Re(){let t=[],e=xe(0,n.length-1e-4);t=[...n[e]],function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(ye(0,1)*(e+1));[t[e],t[i]]=[t[i],t[e]]}}(t);let i=t.length;N=xe(0,i-1e-4);for(let e=0;e<i;e++){let i={h:0,s:0,l:0};d(t[e]).getHSL(i);let s=i.h,n=i.s*ye(.65,.95),l=r().clamp(i.l,.3,.9);St&&(n=0);let o=c().setHSL(s,n,l);I.push(o),j.push(o);let a=[o,[]];for(let t=0;t<2;t++){let t=i.h,e=i.s*ye(.5,.9,.735),s=r().clamp(r().lerp(r().clamp(i.l+.2,0,1),r().clamp(.8*i.l,0,1),H),.1,.9);St&&(e=0);let n=c().setHSL(t,e,s);U.push(n),a[1].push(n)}X.push(a),Z=j.length-1-N}}function De(){let t=N;return N++,N>=j.length&&(N=0),X[t][0]}function Be(){let t=Z;Z--,Z<0&&(Z=j.length-1);let e=xe(0,X[t][1].length-1e-4);return X[t][1][e]}function Te(){return ye(0,1)<.5?De():Be()}function Ge(){let t;if(Tt=new i.InstancedBufferGeometry,St)t=new i.PlaneGeometry(1,1,6,1);else if(6!=F){let s=r().clamp(Math.floor((at+3)/10)+1,3,e?5:8);mt>.5&&(s=7),t=new i.PlaneGeometry(1,1,s,1)}else t=new i.PlaneGeometry(1,1,2,4);let s=(new i.BufferGeometry).fromGeometry(t),n=r().clamp(3*Math.floor(at/10)+1,8,16);mt>.5&&(n=16);let l=new i.CircleGeometry(.5,n),o=(new i.BufferGeometry).fromGeometry(l);1==F||7==F||4==F?(Tt.index=o.index,Tt.attributes=o.attributes):(Tt.index=s.index,Tt.attributes=s.attributes);let a=32768;mt>0?(qt=new Float32Array(Nt),Yt=new Float32Array(Zt),It=new Float32Array(Kt),jt=new Float32Array(_t),Ut=new Float32Array($t)):(qt=new Float32Array(3*a),Yt=new Float32Array(4*a),It=new Float32Array(4*a),jt=new Float32Array(4*a),Ut=new Float32Array(4*a)),Tt.setAttribute("translate",new i.InstancedBufferAttribute(qt,3)),Tt.setAttribute("maxSize",new i.InstancedBufferAttribute(Yt,4)),Tt.setAttribute("frames",new i.InstancedBufferAttribute(It,4)),Tt.setAttribute("color",new i.InstancedBufferAttribute(jt,4)),Tt.setAttribute("randoms",new i.InstancedBufferAttribute(Ut,4));let h=new i.Mesh(Tt,Gt);h.frustumCulled=!0,mt>0&&(qt=null,Yt=null,It=null,jt=null,Ut=null,Nt=[],Zt=[],Kt=[],_t=[],$t=[]),b.add(h)}function qe(t,e,i,s,n=0){let l=0==n?s?1.5:.5:n;return Math.pow(r().clamp(.5*Math.sin(e*k*t+l*k)+.5,0,1),i)}function Ye(t,e){let i=Math.sin(e),s=Math.cos(e);return h(t.x*s-t.y*i,t.x*i+t.y*s)}let Ie=h();function je(t,e){let i=Math.pow(Math.random()*t,e),s=2*Math.random()*k,n=Math.cos(s)*i,l=Math.sin(s)*i;return Ie.set(n,l),Ie}function Ue(){let t=0;Mt=window.innerWidth<window.innerHeight,Mt?(t=window.innerWidth*ot,O=1-2.6*t*(1==wt?2.5:1)/window.innerWidth):(t=window.innerHeight*ot,O=1-2.6*t*(1==wt?2.5:1)/window.innerHeight),0==wt&&(O=.91),T=window.innerWidth/2,G=window.innerWidth/2,S.aspect=window.innerWidth/window.innerHeight,S.updateProjectionMatrix(),x.style.position="fixed",x.style.width=(window.innerWidth-2*t).toString()+"px",x.style.height=(window.innerHeight-2*t).toString()+"px",x.style.top=t.toString()+"px",x.style.left=t.toString()+"px",y.style.width=x.style.width,y.style.height=x.style.height,y.style.top=x.style.top,y.style.left=x.style.left,Lt&&(v.style.bottom=t+.125*(1-O)*window.innerHeight+"px",v.style.right=t+.475*(1-O)*window.innerHeight+"px"),A.setSize(window.innerWidth-2*t,window.innerHeight-2*t),q.set(window.innerWidth,window.innerHeight)}function Ve(t){!1!==t.isPrimary&&(Qt=t.clientX-T,Xt=Vt,document.addEventListener("pointermove",Xe),document.addEventListener("pointerup",Je))}function Xe(t){!1!==t.isPrimary&&(Jt=t.clientX-T,zt||(Vt=Xt+(Jt-Qt)*(e?.006:.00175)))}function Je(){!1!==event.isPrimary&&(document.removeEventListener("pointermove",Xe),document.removeEventListener("pointerup",Je))}function Qe(t){if(t.preventDefault(),2==t.touches.length){zt=!0;let e=h(t.touches[0].pageX,t.touches[0].pageY),i=h(t.touches[1].pageX,t.touches[1].pageY);lt=e.distanceTo(i)}}function Ne(t){if(1==t.touches.length&&(zt=!1,t.preventDefault()),2==t.touches.length){zt=!0;let e=h(t.touches[0].pageX,t.touches[0].pageY),i=h(t.touches[1].pageX,t.touches[1].pageY),s=e.distanceTo(i);_e(.02*(s-lt)),lt=s}}function Ze(t){zt=!1}function Ke(t){t.preventDefault(),_e(.003*t.deltaY)}function _e(t){let e=a().subVectors(M,S.position),i=t,s=e.length();if(e.normalize(),s<2.5)i<0&&S.position.add(e.multiplyScalar(i));else if(s>17)i>0&&S.position.add(e.multiplyScalar(i));else{let t=e.multiplyScalar(i).add(S.position),s=t.length();s>2.5&&s<17&&S.position.set(t.x,t.y,t.z)}S.lookAt(M)}function $e(t=!1){let e=document.createElement("a");e.setAttribute("download",tokenData.hash+".png");let i=A.getPixelRatio();A.setPixelRatio(Wt);let n=h();if(t){A.getSize(n);let t=1;if(n.x>n.y){t=n.y/n.x;let e=r().clamp(4*n.x,256,3600);A.setSize(e,e*t,!1)}else{t=n.x/n.y;let e=r().clamp(4*n.y,256,3600);A.setSize(e*t,e,!1)}}let l=h();A.getSize(l),S.aspect=l.x/l.y,S.updateProjectionMatrix(),A.render(b,S),A.domElement.toBlob((function(o){let a=URL.createObjectURL(o);const h=document.createElement("canvas"),r=h.getContext("2d");var c;r.canvas.width=l.x,r.canvas.height=l.y,kt?((c=r.createLinearGradient(0,0,0,l.y)).addColorStop(1,B),c.addColorStop(0,D)):((c=r.createRadialGradient(.5*l.x,.5*l.y,Mt?l.y:l.x,.5*l.x,.5*l.y,0)).addColorStop(1,D),c.addColorStop(0,B)),r.fillStyle=c,r.fillRect(0,0,r.canvas.width,r.canvas.height);let d=s.substring(4);d=d.slice(0,-1);let p=d;var f=new Image;f.onload=function(){for(let t=0;t<h.width;t+=f.width)for(let e=0;e<h.height;e+=f.height)r.drawImage(f,t,e);var s=new Image;s.onload=function(){r.drawImage(s,0,0,l.x,l.y);let o=h.toDataURL("image/png").replace("image/png","image/octet-stream");e.setAttribute("href",o),e.click(),h.remove(),e.remove(),A.setPixelRatio(i),t&&(A.setSize(n.x,n.y),S.aspect=n.x/n.y,S.updateProjectionMatrix())},s.src=a},f.src=p}))}!function(){W=new te,mt=0,/\bHeadlessChrome/.test(navigator.userAgent)&&(mt=1,gt=0,at=60);e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),se.enqueue(at),ct+=at;let n=ye(0,1);n<.15?(ot=0,wt=0):n<.45?(ot=.04,wt=2):(ot=.0125,wt=1);w=document.createElement("div"),x=document.createElement("div"),y=document.createElement("div"),document.body.appendChild(w),w.appendChild(x),w.appendChild(y),P=new g,C=h(ye(.001,.0055,.5),ye(1,2,.5)),Bt=ye(-.11,.11);let d=ye(0,1)<.765,p=0;p=d?xe(0,5.999,1.5):xe(6,10.999,2);F=0;let f=0;Mt=window.innerWidth<window.innerHeight,Mt?(f=window.innerWidth*ot,O=1-2.6*f*(1==wt?2.5:1)/window.innerWidth):(f=window.innerHeight*ot,O=1-2.6*f*(1==wt?2.5:1)/window.innerHeight);0==ot&&(O=.91);St=!1;let u=ye(0,1);u<.0035?p=11:u<.0075&&(p=12);switch(p){case 0:Rt=[.0275,.0275,1],Dt=[.00475,.00525,4];break;case 1:Rt=[.015,.04,.5],Dt=[.002,.015,2];break;case 2:Rt=[.025,.04,2],Dt=[.0035,.0125,1];break;case 3:Rt=[.0275,.0475,1],Dt=[.0035,.008,1];break;case 4:Rt=[.0225,.0425,1],Dt=[.002,.0225,1];break;case 5:Rt=[.02,.04,1],Dt=[.002,.008,.25];break;case 6:Rt=[.025,.05,2],Dt=[.01,.025,2],F=1;break;case 7:Rt=[.0175,.0275,.5],Dt=[.005,.01,2.5],F=6;break;case 8:Rt=[.015,.035,1],Dt=[.00125,.00175,1],F=2;break;case 9:Rt=[.03,.05,2],Dt=[.02,.03,2],F=4;break;case 10:Rt=[.02,.04,2],Dt=[.0015,.0015,1],F=3;break;case 11:Rt=[.01,.03,1],Dt=[75e-5,.001,1],St=!0,F=5;break;case 12:Rt=[.03,.04,2],Dt=[.02,.03,2],F=7,St=!0}(function(t){const e=document.createElement("canvas").getContext("2d");if(e.canvas.width=512,e.canvas.height=128,e.fillStyle=t<7||12==t||9==t?"#000":"#fff",e.fillRect(0,0,e.canvas.width,e.canvas.height),t<7||12==t){for(let t=0;t<4;t++)for(let i=0;i<e.canvas.height;i++)if(ye(0,1)>.35){e.beginPath();let s=xe(t*e.canvas.height,t*e.canvas.height+.25*e.canvas.height-8,.5);e.moveTo(s,i),e.strokeStyle="#fff",e.lineWidth=ye(2,4,2),e.lineCap="round",e.lineJoin="round",e.shadowColor="#000",e.shadowBlur=e.lineWidth/4;let n=xe((t+1)*e.canvas.height-.4*e.canvas.height+8,(t+1)*e.canvas.height,2);e.lineTo(n,i),e.stroke(),e.closePath()}if(6!=t)for(let t=0;t<512;t+=19)for(let i=0;i<e.canvas.height;i+=9)e.fillStyle=Math.random()<.75?"#000":"#999",Math.random()>.8&&e.fillRect(t+20*Math.random(),i+10*Math.random(),32*Math.random(),2*Math.random()+4)}else if(9==t){e.fillStyle="#fff";for(let t=0;t<4;t++)for(let i=0;i<1e3;i++){let i=je(.75*e.canvas.height,.9);i.set(i.x+t*e.canvas.height+.5*e.canvas.height,i.y+.5*e.canvas.height),e.fillRect(i.x,i.y,2,2)}}let s=e.canvas.toDataURL("image/jpeg",1),n=(new i.TextureLoader).load(s);Q.push(n),e.canvas.remove()})(p),Ot=a(ye(0,1),ye(0,1),ye(0,1)),Et=ye(.25,1);window.innerWidth,window.innerHeight;b=new i.Scene,S=new i.PerspectiveCamera(10,window.innerWidth/window.innerHeight,.5,100);let m=ye(.25,4.5);S.position.set(0,m,ye(8.65,12.1,1)),M=a(0,ye(-.175,-.05,.75),0),L=new i.Object3D,L.add(S),b.add(L),q.set(window.innerWidth,window.innerHeight);let T=ye(0,.1*k,4);ye(0,1);L.rotation.set(0,T,0),L.position.set(0,0,0),Vt=-L.rotation.y,z=a(),S.getWorldPosition(z),H=xe(0,1.999,3);let G=9,I=ye(0,100);G=I<3?9:I<10?8:I<18?7:I<29?6:I<44?5:I<60?4:I<78.5?3:2,2==G&&(G+=xe(0,4,2));let U=ye(0,1024);U<1.5?G=0:U<8?G=1:U<25&&(G=10);let V=xe(1,Math.min(G,8)+.999,1.25),X=[3,4,2,5,13,11,1,10],N=ye(0,100),Z=N<3?7:N<10?6:N<18?5:N<29?4:N<44?3:N<60?2:N<78.5?1:0,K=[];for(let t=0;t<V;t++){let e=xe(0,X.length-.001,1.7);0==t&&(e=Z),K.push(X[e]),X.splice(e,1),0==t&&10!=e&&V<8&&X.splice(X.length-1,1)}Re(),w.style.position="absolute",w.style.margin="0",w.style.width="100%",w.style.height="100%",x.style.zIndex="10",x.style.position="fixed",x.style.width=(window.innerWidth-2*f).toString()+"px",x.style.height=(window.innerHeight-2*f).toString()+"px",x.style.top=f.toString()+"px",x.style.left=f.toString()+"px",y.style.position="fixed",y.style.width=(window.innerWidth-2*f).toString()+"px",y.style.height=(window.innerHeight-2*f).toString()+"px",y.style.top=f.toString()+"px",y.style.left=f.toString()+"px";let _=Be(),$=Be();H>.5&&(_=Oe(_,.75),$=Oe($,.25));E=_,R=$,D="#"+E.getHexString(),B="#"+R.getHexString(),St&&(H>.5?(B="black",D="black"):(B="white",D="white"));let tt=ye(0,360),et="";ye(0,1)<.6?(kt=!1,et=s+", radial-gradient("+D+" 0%,"+B+")"):(kt=!0,et=s+", linear-gradient("+tt.toString()+"deg, "+D+", "+B+")");y.style.backgroundImage=et;let it=ye(0,1)>.5?Oe(E):Ee(E,.1),st="#"+it.getHexString(),nt="#"+(ye(0,1)>.5?Oe(it,.85):Ee(it,.15)).getHexString();tt=ye(0,360),w.style.backgroundImage=s+", linear-gradient("+tt.toString()+"deg, "+st+", "+nt+")",ot>0&&(y.style.boxShadow="inset 0 0 6px "+st);if(Lt=ye(0,1)<.25,Lt){v=document.createElement("div"),y.appendChild(v),v.style.position="fixed",v.style.bottom=f+.125*(1-O)*window.innerHeight+"px",v.style.right=f+.475*(1-O)*window.innerHeight+"px",v.innerHTML=t.toString()+" 1/1/987",v.style.textAlign="right",v.style.verticalAlign="bottom",v.style.fontSize="1vmin",v.style.fontFamily="monospace";let e=c(H,H,H);e.lerp(R,.65),v.style.color="#"+e.getHexString()}let lt=.04,ht=lt/6;for(let t=0;t<6;t++){j[xe(0,j.length-1e-4)];let e=new i.MeshBasicMaterial({color:H>.5?Ee(E):Oe(E)});if(mt>0){let s=new i.RingGeometry(.0015,.002,16),n=new i.RingGeometry(0,.002,16),l=new i.Mesh(s,e),o=new i.Mesh(n,e);S.add(l),S.add(o),l.position.set(ht*t-.02+.5*ht,-.1675,-2),o.position.set(ht*t-.02+.5*ht,-.1675,-2),o.visible=!1,J.push(l),J.push(o)}}let rt=[],pt=0;for(let t=0;t<K.length;t++)rt.push(j[pt]),pt++,pt>=5&&(pt=0);const ft=[];let ut=ye(.35,.45),At=ye(.125,.175),zt=ye(.025,.1),Pt=ye(.5,6,2),Ct=ye(.5,2),Ft=ye(0,2*k),Ht=ut/32,Wt=-1,Tt=0;for(let t=0;t<=ut;t+=Ht){let e=qe(t/ut,Pt,Ct,null,Ft);t/ut>.85&&Wt<0&&(Wt=t/ut*ut,Tt=At+e*zt),ft.push(h(At+e*zt,t))}let qt=new i.LatheGeometry(ft,64),Yt=(new i.BufferGeometry).fromGeometry(qt).attributes.position,It=Te(),jt=ye(0,1)<.75?Oe(It):Oe(De());const Ut=We(4,8,32,184,1,[At,At+zt],[jt,It],!0,[0,0,0],[0,-.735,0],b,1);const Xt=We(4,6,8,16,1,ee=[2,.8*Tt,1,1],[c(.65,.65,.65),c(.5,.5,.5)],!0,[.5*k,0,0],[0,-.735+Wt,0],b,1,!0);Ut.v2S=Yt,Ut.noiseAffect=.9,Xt.noiseAffect=.9;let Jt=Be(),Qt=Be(),Nt=new i.Object3D,Zt=ye(-.25,.25)*k,Kt=ye(0,1)<.4;0==G&&(Kt=!0);if(Kt){let t=De(),e=Be(),i=[t,e];if(ye(0,1)<.6){We(2,7,16,256,1,[1.5,1,.01,1,1,1],[i[0],i[1]],!0,[0,ye(-.04,.04),0],[ye(-.15,.15),-.735,ye(.1,-.1)],b,1,!1,!1)}else{We(2,6,64,96,1,[2,.65,1,1],[i[0],i[1]],!0,[.5*k,0,0],[ye(-.15,.15),-.735,ye(-.15,.15)],b,1)}}let _t=ye(0,1)<.85,$t=xe(0,3.999,1.5);0==G&&(_t=!0);if(_t)switch($t){case 0:let t=ye(0,1)>.8;We(1,7,64,256,1,ee=[3,1,1.5,.1,2.1,1],[Be(),De()],!0,[0,0,0],[0,-1.505,0],Nt,1,t,!1);break;case 1:We(1,6,64,128,1,ee=[2,3,.4,4],[De(),Be()],!0,[.5*k,0,0],[ye(-.2,.2),-.755,ye(-.2,.2)],b,1,!0);break;case 2:var ee,ie=Be(),ne=Te();We(1,6,32,216,1,ee=[1,4,.333,1],[De(),ie],!0,[.5*k,0,0],[0,-.8,-1.25],Nt,1,!0,!1,!0),We(1,6,32,216,1,ee,[De(),ne],!0,[0,0,0],[0,-.8,-1.25],Nt,1,!0,!1,!0),We(1,7,4,16,1,le=[2,4,.01,1,.01,1],[Oe(ie),Oe(ne)],!0,[0,0,0],[1,-.775,-1.225],Nt,1,!0,!1,!0),We(1,7,4,16,1,le,[Oe(ie),Oe(ne)],!0,[0,k,0],[-1,-.775,-1.225],Nt,1,!0,!1,!0);break;case 3:ie=De();var le,ae=H>.5?Oe(ie):Ee(ie),re=(ne=De(),H>.5?Oe(ne):Ee(ne)),ce=Be(),de=Be();We(1,6,64,52,1,[.6,4,.25,1],[ie,ae],!0,[.5*k,0,.2*k],[0,-.8,-1.75],Nt,1,!0,!1,!0),We(1,6,64,52,1,le=[.5,4,.5,3],[ne,re],!0,[0,-.2*k,0],[0,-.8,-1.75],Nt,1,!0,!1,!0),We(1,6,64,52,1,le,[ce,de],!0,[0,-.8*k,0],[0,-.8,-1.75],Nt,1,!0,!1,!0)}if(!_t||$t<2){let t=ye(0,1);if(t<.2){We(3,6,64,96,1,[2,.9,1,1],[De(),Te()],!0,[0,0,0],[0,.25,-1.1],Nt,1,!1)}else if(t<.35){if(_t&&0==$t){We(3,6,64,96,1,[1,.85,0,2,.75],[De(),Te()],!0,[0,0,0],[0,-.775,-.95],Nt,1,!1)}}else if(t<.6){We(3,6,64,96,1,[2,.85,0,2,.65],[De(),Te()],!0,[0,0,0],[0,.25,-1.1],Nt,1,!1)}if(ye(0,1)<(G<4?.9:.7)){We(0,6,64,48,1,[2,2.75,.5,1],[Be(),Be()],!0,[0,0,0],[0,.65*-m,-5],b,1,!0,!1,!0)}}if(ye(0,1)<.05){We(1,7,16,64,1,[6,1,4,1,6,1],[Jt,Qt],!0,[0,0,0],[0,0,0],Nt,1,!0)}Nt.rotation.set(0,Zt,0),b.add(Nt);let pe=[],fe=xe(0,18.999,2),ue=At+zt;xt=0;for(let t=0;t<fe;t++){let t=!1,e=ye(ue,.8),i=ye(-.4*k,.4*k);ye(0,1)>.5&&(i+=k);let s=a(Math.cos(i)*e,0,Math.sin(i)*e);if($t<2){s.multiply(a(1.35,1,1));let t=Ye(h(s.x,s.z),-Zt);s.set(t.x,s.y,t.y)}let n=Fe(s);2==n.index&&e<.65&&(t=!0);let l=.015;if(4==n.index&&(l=.15),5==n.index&&(l=.15),Math.hypot(n.position.x-0,n.position.z-0)<=n.radius+ue+l||t)t=!0;else if(pe.length>0)for(let e=0;e<pe.length;e++){Math.hypot(n.position.x-pe[e].position.x,n.position.z-pe[e].position.z)<=n.radius+pe[e].radius+l&&(t=!0)}if(!t){let t=He(n);switch(t.index){case 0:0;break;case 1:0;break;case 2:0;break;case 3:0;break;case 4:xt++;break;case 5:0;break;case 6:0}pe.push(t)}}let we,ve=r().lerp(.5,.4,(G-1)/9);if(G>3)we=Pe(G+4,ye(0,2*k),0);else{we=Pe(G+3,ye(0,0*k),ye(.35*k,.35*k));for(let t=0;t<we.length;t++)we[t].x=we[t].x*Math.sign(ye(-1,1))}for(let t=0;t<we.length;t++)we[t].z*=ye(.65,1);let Se=[];for(let t=0;t<K.length;t++)Se.push(me());let Me=0,be=function(t){let e=[];for(let i=0;i<t.length;i++){let s=[];1===t[i]&&(s=[ye(2,6),ye(.05,.1),ye(1.5,4),ye(.5,2)]),e.push(s)}return e}(K);yt=0;for(let t=0;t<G;t++){let e=rt[Me],s=ye(0,100)<.95;s&&(e=c(.3,.3,.3));let n=Oe(e),l=Ee(e),o=[n,e,l];if(ye(0,100)<2*(1+2.5*yt)&&!St&&!s&&10!=K[Me]){yt++,e=De(),n=Oe(De()),l=De();let t=De(),i=Ee(De());o=[n,e,l,t,i]}let h=Se[Me];s&&(h=c(.15,.15,.15));let r=[[ge(h),ge(h)],o],d=new i.Object3D,p=we[t].clone().multiplyScalar(G<5?.9:1);d.lookAt(p.clone().multiply(a(1,.4,1))),s&&d.lookAt(p.clone().add(a(p.x,-2,p.z))),p.multiplyScalar(ve),d.position.set(p.x,p.y,p.z);let f=new he(Y.length,K[Me],ve,r,be[Me],s,d);f.create(),Y.push(f),Me++,Me>=K.length&&(Me=0)}(function(t){let s,n,a,r,c;switch(t){case 0:s=0,n=!1,a=0,r=1,c=h(0,1);break;case 1:s=1,n=!0,a=0,r=1,c=h(0,1);break;case 2:s=0,n=!1,a=1,r=.65,c=h(0,1);break;case 3:s=1,n=!1,a=1,r=0,c=h(0,1);break;case 4:s=1,n=!1,a=0,r=1,c=h(0,1);break;case 5:s=0,n=!1,a=0,r=1.5,c=h(0,1);break;case 6:s=1,n=!1,a=0,r=1,c=h(1,1);break;case 7:s=1,n=!1,a=0,r=1.25,c=h(0,1)}let d=1;n&&(d=.4);Gt=new i.RawShaderMaterial({uniforms:{time:{value:0},cameraPos:{value:S.position},cameraAngle:{value:L.rotation.y},noiseFreq:{value:C},window:{value:q},border:{value:O},straighten:{value:s},crossHatch:{value:a},noiseScale:{value:r},outline:{value:c},headless:{value:mt},alph:{value:d},dusk:{value:H},map:{value:Q[0]},anim:{value:gt},fpsToggle:{value:1},transToggle:{value:vt}},vertexShader:"//by Ian McEwan, Ashima Arts \n precision highp float;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform float time; uniform vec2 noiseFreq;uniform float fpsToggle;uniform float transToggle;uniform vec3 cameraPos;uniform float cameraAngle;uniform vec2 window;uniform float border;uniform float anim;uniform float straighten;uniform float crossHatch;uniform float noiseScale;uniform vec2 outline;uniform float alph;uniform float dusk;uniform float headless;attribute vec3 position;attribute vec4 maxSize;attribute vec4 color;attribute vec4 frames;attribute vec3 translate;attribute vec4 randoms;attribute vec2 ss;varying float trans;varying float tI;varying vec3 vC;varying vec3 nXY;vec3 permute(vec3 x){return mod(((x*34.0)+1.0)*x,289.0);}float snoise(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)?vec2(1.0,0.0):vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod(i,289.0);vec3 p=permute(permute(i.y + vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)),0.0); m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}float sc(float t,float waveLength,float power,float startAtZero){return pow(clamp(0.5*sin(waveLength*3.1415926538*t+startAtZero*3.1415926538)+0.5,0.,1.),power);}vec2 r2d(vec2 v,float r){float s=sin(r);float c=cos(r);return vec2(v.x*c-v.y*s,v.x*s+v.y*c);}float gt(float x,float y){return max(sign(x-y),0.0);}float hd(vec3 from,vec3 to){float dx=abs(to.x-from.x);float dy=abs(to.y-from.y);float dz=abs(to.z-from.z);float d=dx+dy+dz;float md=max(dz,max(dy,dx));return 0.394*d+0.554*md;}void main(){vec3 p0=position;vec3 t0=translate;float t=clamp((clamp(time-frames.x, 0., 10000.)/(frames.y-frames.x)),0.,1.);float l=(mod(time-frames.x,frames.z)/frames.z);float sOL=1.-sc(l,2.6666,200.,0.5);sOL=mix(t,sOL,clamp((time/1200.),0.,1.));sOL*=(1.-gt(l,0.75));sOL=mix(t,sOL,gt(frames.w,0.));sOL=mix(t,sOL,clamp((time/600.),0.,1.));sOL=sOL*gt(randoms.z,1.-fpsToggle);sOL=mix(1.,sOL,anim);vec2 r=r2d(t0.xz,-cameraAngle*randoms.x);float pOL=mix(sc(l,1.3333,400.,1.5),0.,headless);pOL=mix(0.,pOL,anim);float mD=mix(0.,pOL,gt(frames.w,0.));vec3 tt=vec3(r.x,t0.y-mD*0.1*(randoms.z*0.5+0.5),r.y);nXY=vec3(p0.x + 0.5,p0.y + 0.5,randoms.z);vec3 mP=vec3(p0.x,p0.y,p0.z);float x=(time*mix(0.0011,0.,headless)+(randoms.w+randoms.z*0.05))-floor((time*0.0011+(randoms.w+randoms.z*0.05)));float y=mix(1.,1.-sc(x,2.,30.,0.5),anim);float ps=gt(x,0.5);float pv=mix(1.,-1.,ps);float pd=(mP.x-pv)*y;mP.x=pv+pd;vec4 dp=modelMatrix*vec4(tt,1.);float cd=hd(dp.xyz,cameraPos);float df=max(min((cd*0.087489*2.),mix(3.,2.,maxSize.w)),mix(0.,1.,pow(clamp(cd -1.4,0.,1.),1.2)));vec3 lp=mix(vec3(mP*maxSize.xyz*vec3(y,1.,1.)*sOL*df), mP*maxSize.xyz*df,headless);vec3 tlp=mix(vec3(lp.x*0.925,0.,lp.z * 0.8),vec3(0.,0.,0.),straighten)+tt;vec4 mvdp=modelViewMatrix*vec4(tlp,1.);vec4 glpp=projectionMatrix*mvdp;vec3 ndc=glpp.xyz/glpp.w;float vt=time*0.00035;vec3 vco=vec3((ndc.xy*0.5+0.5),1);vec3 vpcp=vec3(window.x,window.y,1.)*vco*noiseFreq.x+vec3(vt*0.5,vt*0.5,vt);float an=snoise(vpcp.xy);lp.y+=(an-.25)*.015;lp.x+=(an+.25)*.005;an*=noiseScale;vec3 rLP=vec3(r2d(lp.xy,an*noiseFreq.y+0.5*3.1415926538*gt(randoms.y,0.5)*crossHatch),0.);vec4 mvP=modelViewMatrix*vec4(tt,1.);float e=border;vec3 sslp=tt;vec4 mvss=modelViewMatrix*vec4(sslp,1.);vec4 glss=projectionMatrix*mvss;vec3 ndss=glss.xyz/glss.w;float f=(window.x-(window.y-(e*window.y)))/window.x;float wxx=f-0.065;float wx=clamp(abs(ndss.x)-wxx,0.,1.);float txMod=1.-(wx/0.075);float wyy=e-0.065;float wy=clamp(abs(ndss.y)-wyy,0.,1.);float tyMod=1.-(wy/0.075);mvP.xyz+=rLP;mvP.xyz+=mvP.xyz*(gt(abs(ndss.x),f)+gt(abs(ndss.y),e))*1000.;float vig=pow((hd(vec3(ndc.xy*0.5,0.) / 1.2, vec3(0.,0.,0.))) * 2., 2.5);float xc=(p0.x/0.5)+0.5;float yc=abs(p0.y)/0.5;float iO=mix(0.,clamp(gt(yc,0.8),0.,1.),outline.x);vC=mix(color.xyz,color.xyz+mix(vec3(0.2,0.2,0.2),vec3(-0.275,-0.275,-0.275),dusk),vig)*(xc*0.035+0.965);vC=mix(vC*0.625,vC,1.-iO);vC=mix(vC,vC*0.75,pOL);trans=mix(1.,alph*(txMod*tyMod*0.75+ 0.25),transToggle);tI=color.w;gl_Position=projectionMatrix*mvP;}",fragmentShader:e?l+o:l+"nc=nc+vec3(random(nXY.xy)*0.082-0.041);"+o,depthTest:!0,depthWrite:!0,transparent:!0}),mt<.5&&e&&1!=t&&(Gt.transparent=!1,vt=0,Gt.uniforms.transToggle.value=vt)})(F),0==mt&&Ge();A=new i.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),e?A.setPixelRatio(.65*window.devicePixelRatio):A.setPixelRatio(window.devicePixelRatio);A.setSize(window.innerWidth-2*f,window.innerHeight-2*f),oe=dt,x.appendChild(A.domElement),x.addEventListener("pointerdown",Ve),document.addEventListener("keydown",(t=>{82==t.keyCode&&(bt=!bt),65==t.keyCode&&(gt=Math.abs(gt-1),Gt.uniforms.anim.value=gt),67==t.keyCode&&$e(),72==t.keyCode&&$e(!0)})),x.addEventListener("touchstart",Qe),x.addEventListener("touchend",Ze),x.addEventListener("touchmove",Ne),x.addEventListener("mousewheel",Ke,{passive:!1}),window.addEventListener("resize",Ue)}(),function t(i){requestAnimationFrame(t),bt&&(Vt+=.04*tt);if(L.rotation.y-=.05*(Vt+L.rotation.y),tt=.016667,mt<.5&&K>10){let t=performance.now();tt=.001*(t-pt);let i=1/tt;se.enqueue(i),ct+=i,se.getCount()>45&&(ct-=se.dequeue(),at=ct/se.getCount()),at=r().clamp(at,0,60),at<28?(ft>80&&!Ct&&(1!=F&&(Gt.transparent=!1,vt=0,Gt.uniforms.transToggle.value=vt),e||(A.setPixelRatio(.65*Wt),Gt.fragmentShader=l+o),Gt.needsUpdate=!0,Ct=!0),ft++):ft>0&&ft--,pt=t}oe<100&&(ht++,ht%15==0&&oe++);if(null!=Gt){mt>0?Gt.uniforms.time.value=it:(_=Math.floor(60*performance.now()*.001),Gt.uniforms.time.value=_);let t=a();S.getWorldPosition(t),Gt.uniforms.cameraPos.value=t,Gt.uniforms.cameraAngle.value=L.rotation.y,Gt.uniforms.window.value=q,Gt.uniforms.border.value=O}if(mt>0){if(K>5&&!Pt){let t=Math.floor(J.length/2*r().clamp((K-5)/10,0,1));for(let e=0;e<t;e++){let t=2*e;J[t].visible=!1,J[t+1].visible=!0}for(let t=0;t<V.length;t++)V[t].create();Nt.length==nt&&st++,st>=5&&(Pt=!0),nt=Nt.length}if(Pt){for(let t=0;t<J.length;t++)J[t].visible=!1;null==Tt&&Ge(),it++}}else if(K>5){let t=!0;for(let e=0;e<V.length;e++)if(V[e].normalizedLife<1){t=!1;break}if(t&&null==ie.peek())null!=qt&&(qt=null),Yt=null,It=null,jt=null,Ut=null;else{Tt.attributes.translate.needsUpdate=!0,Tt.attributes.maxSize.needsUpdate=!0,Tt.attributes.frames.needsUpdate=!0,Tt.attributes.color.needsUpdate=!0,Tt.attributes.randoms.needsUpdate=!0;for(let t=0;t<V.length;t++)V[t].create();se.getCount()>=45*.333&&function(){let t=r().clamp(Math.pow(oe+1,3),0,512),e=at>25?1:0;for(let i=0;i<t&&null!=ie.peek();i++){let t=ie.dequeue();qt[3*et+0]=t.p.x,qt[3*et+1]=t.p.y,qt[3*et+2]=t.p.z,Yt[4*et+0]=t.mS.x,Yt[4*et+1]=t.mS.y,Yt[4*et+2]=t.mS.z,Yt[4*et+3]=t.mS.w,It[4*et+0]=K,It[4*et+1]=K+ye(0,40,1)*e,It[4*et+2]=t.dO,It[4*et+3]=t.dE,jt[4*et+0]=t.c[0],jt[4*et+1]=t.c[1],jt[4*et+2]=t.c[2],jt[4*et+3]=t.c[3],Ut[4*et+0]=t.ss,Ut[4*et+1]=t.r[1],Ut[4*et+2]=t.r[2],Ut[4*et+3]=t.r[3],et%32768==0&&(et%=32768,Ge()),et++}}()}}S.lookAt(M),A.clear(),A.render(b,S),K++}();