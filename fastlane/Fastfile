default_platform(:mac)

platform :mac do

  lane :deliver_metadata do
    update_fastlane
    deliver(
      metadata_path: "./fastlane/metadata",
      screenshots_path: "./fastlane/screenshots",
      overwrite_screenshots: true, 
      platform: "osx",
      run_precheck_before_submit: false,
      force: true,
    )
  end

  lane :release do
    # TODO: nullify FASTLANE_PASSWORD

    require 'spaceship'
    Spaceship::Tunes.login('ivan@ivan.lol')

    # TODO: set FASTLANE_PASSWORD

    update_fastlane
    
    gym(scheme: "nft-folder", output_directory: "fastlane/build", clean: true)
    deliver(
      metadata_path: "./fastlane/metadata",
      screenshots_path: "./fastlane/screenshots",
      overwrite_screenshots: true, 
      platform: "osx",
      run_precheck_before_submit: false,
      force: true,
    )
    clean
  end

  lane :clean do
    sh "rm -rf #{File.expand_path('build')}"
  end

end